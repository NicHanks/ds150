'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[38],{1397:function(B,A,a){function c(mb,Oc,jd,ud,pd,id=!1){mb=String.format("{0}{1}?action={2}&{3}",mb,Oc,pd,jd);"setpolicylabel"===pd&&ud&&(mb=Cc.a.Zn(mb,"sl","1"));id&&(mb=Cc.a.Zn(mb,"cbd","1"));return mb}function b(mb){switch(mb){case 1:return lb.a.Mpa(1,1);case 2:return lb.a.Mpa(7,1);case 3:return lb.a.Mpa(8,1);default:return lb.a.Mpa(7,0)}}function k(mb){return!!mb&&mb.AreLabelsAvailable&&!!mb.SensitivityLabels&&
0<mb.SensitivityLabels.length&&mb.SensitivityLabels.some(Oc=>!!Oc&&Oc.Enabled)}function m(mb,Oc,jd,ud,pd,id,Ed,Pd=0,lc=null){const Kc={};Kc[Ya.a.Djh]=id;id=mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1);mb.la("SendHostAttributionInfoForPolicyLabelEnabled")?(mb=new Hb(pd,1,null,Kc,!0,2,Pd,void 0,id?lc:void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ed),Oc.send(mb).p2d(jd,ud)):Oc.ir(pd,1,null,Kc,!0,2,jd,ud,Pd,id?lc:void 0,
void 0,void 0,void 0,"22")}a.r(A);var d={};a.r(d);a.d(d,"SensitivityCommandHandler",function(){return fd});var n=a(0),l=a(15),f=a(128),h=a(954),t=a(200),u=a(584);class v{constructor(mb,Oc,jd=null){this.id=mb.Id;jd||(jd="");this.rOj=jd;this.sensitivityLabel=mb}}Object(n.a)(v,"AutoPolicyLabelData",null,[]);class y{constructor(mb,Oc){this.PR=mb;this.displayName=Oc}}Object(n.a)(y,"PolicyLabelRequestState",null,[]);class C{constructor(){this.z8d=this.pTd=""}}Object(n.a)(C,"PolicyStrings",null,[]);var x=
a(191),w=a(5),z=a(178),F=a(16),J=a(48),R=a(32);class I{static get wMd(){return I.G4i}}I.G4i="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(n.a)(I,"JustificationDialogHtml",null,[]);class O extends x.a{constructor(mb,Oc){super(!1,!1,O.Dz);this.Jya=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.q9b=null;this.o9b=!1;this.F4i=(jd,ud)=>{let pd="";if(1===jd)for(let id=0;id<this.Jya.length;id++)if(ud[O.E0d+id]){pd=id===this.Jya.length-1?ud[O.x0b]:this.Jya[id];break}this.AD(jd,this.a$b,pd)};this.$fg=jd=>{let ud="";1===
jd&&this.q9b&&(ud=this.q9b);this.AD(jd,this.a$b,ud)};this.ytj=jd=>{this.q9b=jd;jd=this.validate();this.o9b!==jd&&(this.o9b=jd,this.rKa(CommonUIStrings.l_SensitivityJustificationTitle,this.$fg,this.Vsf(this.o9b)))};this.Ptk=jd=>{jd.target&&this.KQ(1,this.validate())};this.zeg=jd=>{if(jd=jd.target){jd.checked=!0;var ud=$get(O.x0b);jd.id===O.E0d+(this.Jya.length-1)?(ud.disabled=!1,Sys.UI.DomElement.setVisible(ud,!0),ud.focus()):(ud.disabled=!0,jd.focus());this.KQ(1,this.validate())}};this.a$b=mb;this.AD=
Oc;this.Wi=this.Rph();this.Ye=1;this.xh=O.id;this.uf(1,CommonUIStrings.l_DialogChange);this.KQ(1,!1);this.m2(0)}Dce(){if(O.Dz)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,this.$fg,this.Vsf(this.o9b));else{const mb={};for(let Oc=0;Oc<this.Jya.length;Oc++)mb[O.E0d+Oc]=!1;mb[O.x0b]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,this.F4i,mb);this.vQj();J.a.addHandler($get(O.x0b),F.a.input,this.Ptk)}}validate(){if(O.Dz)return this.BNg(this.q9b);const mb=
$get(O.x0b);return mb.disabled?!0:this.BNg(mb.value)}BNg(mb){const Oc=2>mb.length,jd=500<mb.length,ud=RegExp("[{|}|;|\\\\]").test(mb);mb=""===R.a.AIc(mb);return!Oc&&!jd&&!ud&&!mb}Vsf(mb){return{["id"]:this.xh,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!mb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,
["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:this.ytj}}Rph(){return x.a.Rq(O.wMd,w.AFrameworkApplication.Vw,z.getImageClass(O.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.Jya[0],this.Jya[1],this.Jya[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}vQj(){const mb=document.getElementsByName(O.t7i);for(let Oc=0;Oc<mb.length;Oc++)J.a.addHandler(mb[Oc],
F.a.focus,this.zeg),J.a.addHandler(mb[Oc],F.a.click,this.zeg)}static get Dz(){return w.AFrameworkApplication.ra.Pa.cA&&w.AFrameworkApplication.ra.Pa.gKd}}O.wMd=I.wMd;O.t7i="ListRadioBox";O.E0d="radiobox";O.x0b="txtJustification";O.iconName="Info_32x32x32";O.id="JustificationDialog";Object(n.a)(O,"JustificationDialog",x.a,[]);class Y extends x.a{constructor(mb,Oc,jd){super(!1,!1,!0);this.Rcj=(pd,id)=>{1===pd&&id.selectedLabel&&(pd=id.selectedLabel,""!==pd&&this.nYg(pd))};if(mb&&jd){var ud={["id"]:"MandatoryLabellingDialog"};
this.nYg=jd;this.l3c=Oc;if(!w.AFrameworkApplication.fa.la("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.l3c&&""!==this.l3c)ud.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.l3c,["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Oc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Oc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:mb});ud.labelFlyout=
{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Oc};mb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:ud};ud.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;ud.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,this.Rcj,mb)}else l.ULS.sendTraceTag(560547850,
306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}}Object(n.a)(Y,"MandatoryLabellingDialog",x.a,[]);class K{constructor(){this.Oub=!!w.AFrameworkApplication.ra&&w.AFrameworkApplication.ra.Pa.cA}JIh(mb,Oc,jd){this.Oub&&new Y(mb,Oc,jd)}static get instance(){return K.Ka||(K.Ka=new K)}}K.Ka=null;Object(n.a)(K,"MandatoryLabellingDialogFactory",null,[244]);class L{}L.Bqk="sbProtectForm14";L.Dqk="SBStatusBarMarkAsReadOnly14";L.wOf="Info_16x16x32";L.gCb="QuickSearchCompletedToday_16x16x32";
L.i1d="CommonControlCheckboxCheck_16";L.gGg="On";L.visible="Visible";L.ebi="ImageIsVisible";L.NI="SourceControlId";L.menuItemId="MenuItemId";L.menu="Menu";L.Wcd="AppLockId";L.value="Value";L.xl="LabelText";L.alt="Alt";L.xBf="Image16by16";L.$ra="Image16by16Class";L.Aqk="SBProtectForm_16";L.Cqk="SBStatusBarMarkAsReadOnly_16";L.icon="Icon";L.iconColor="IconColor";L.customTooltip="CustomTooltip";L.pNj="MipTagDynamicFillWithOutline_20";L.qNj="MipTagLockDynamicFillWithOutline_20";L.oNj="MipTagErrorOutline_20";
L.rNj="MipTagQuestionOutline_20";L.wRc="transparent";L.wAk="UILocation";Object(n.a)(L,"PolicyConstants",null,[]);class X extends x.a{constructor(mb,Oc,jd){super(!1,!1,X.Dz);this.CHk=ud=>{1!==ud&&this.AD(ud,this.a$b,"",this.J5a)};this.a$b=mb;this.J5a=Oc;this.AD=jd;this.Ye=1;this.xh=X.id;this.m2(1);this.m2(0)}dde(){const mb={["id"]:"UserDefinedPermissionsDialog"};X.Dz&&this.initializeAndShow("Defined Permissions",this.CHk,mb)}static get Dz(){return w.AFrameworkApplication.ra.Pa.cA&&w.AFrameworkApplication.ra.Pa.gKd}}
X.id="UserDefinedPermissionsDialog";Object(n.a)(X,"UserDefinedPermissionsDialog",x.a,[]);var T=a(623),ba=a(398),Q=a(282),P=a(600),ka=a(112),ia=a(102),Ba=a(590),va=a(587),W=a(152),S=a(455),da=a(167),aa=a(444),za=a(123),qa=a(81),ta=a(129),Xa=a(24),oa=a(69),ha=a(367),Za=a(64);const Fa=mb=>mb?mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CleanUpMsospPolicyScript",!1):w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CleanUpMsospPolicyScript",!1);class La{constructor(mb,
Oc,jd,ud){this.$ub=this.XMa=null;this.Jwe=this.c2c=this.x2c=this.Rub=this.Txe=this.Hze=this.NYc=!1;this.A4a=this.Hma=this.yna=this.Kxa=this.J5a=this.np=this.wO=this.zi=null;this.FXg=this.DWc=0;this.xte=this.t2c=this.RWc=this.M5c=null;this.BPj=()=>{this.c2c&&!this.Wvc()&&(this.c2c=!1,this.Nj.value.APj())};this.Qcj=pd=>{this.Qqd(this.Ize[pd])};this.U_d=()=>{if(!this.Nj.value.tKf()){var pd=this.np[this.zi.AppliedPolicyId];this.Rub&&this.Kxa&&this.A4a!==this.Kxa.id&&(!pd||pd.Order<this.Kxa.sensitivityLabel.Order)&&
(pd=this.hJa(this.Kxa.id,{},4),32!==pd?l.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+pd):(this.A4a=this.Kxa.id,this.Hma&&(pd=this.np[this.Hma])&&pd.Order<=this.Kxa.sensitivityLabel.Order&&(this.Nj.value.ala(29),this.Hma=null)));pd=this.np[this.Nj.value.an.AppliedPolicyId];if(this.yna&&this.Hma!==this.yna.id&&(!pd||pd.Order<this.yna.sensitivityLabel.Order)){const id=this.yna.id;this.Nj.value.ala(29);this.Nj.value.Eyb(29,CommonUIStrings.l_PolicyBusinessBarTitle,
String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.Fdb(this.yna.sensitivityLabel))+" "+this.yna.rOj,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.hJa(id,{},8)});this.Hma=this.yna.id}this.yna=this.Kxa=null}};this.vDh=(pd,id,Ed,Pd)=>{1===pd&&this.U0a(id,Pd)};this.uDh=(pd,id,Ed)=>{1===pd?this.HWa()?this.hJa(id,null,2,Ed):this.U0a(id===this.zi.AppliedPolicyId?"":id,Ed):this.ej.px()};this.aoh=pd=>{1===pd&&this.Nj.value.nMj()};this.ilc=()=>32;this.Czj=(pd,id)=>{id.nX&&this.np&&
(pd=this.np[this.Nj.value.an.AppliedPolicyId])&&(this.Hma&&(id=this.np[this.Hma])&&id.Order<=pd.Order&&(this.Nj.value.ala(29),this.Hma=null),this.A4a&&this.A4a!==pd.Id&&(this.Nj.value.ala(28),this.A4a=null))};this.Ma=mb;this.ej=Oc;this.Fa=jd;this.Nj=ud;this.Evb={};this.FCe={};this.Ize={};this.pvc=jd.la("WacApplyManualPolicyLabelIsEnabled");this.Nj.value.qNe(this.U_d);this.Nj.value.acd(this.U_d);this.Nj.value.hzb(this.Czj);w.AFrameworkApplication.ra&&w.AFrameworkApplication.ra.Peh(this.BPj);jd.la("SupportsPolicies")&&
jd.Ta("AppliedPolicyId")&&(this.XMa=jd.Ta("IrmPolicyTitle"),this.$ub=jd.Ta("IrmPolicyDescription"));this.UVg=this.Fa.Ng("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.VVg=this.Fa.Ng("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get ogb(){return w.AFrameworkApplication.ogb||!!this.t2c&&this.t2c()}ik(){this.Ma.hf(Xa.a.xXd,ta.a.frame,this.ilc);this.Ma.ji(Xa.a.Ilb,ta.a.frame,Object(f.a)(this,this.Ilb,"queryPolicyLabel"),96);this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",
!1)&&(this.Ma.hf(Xa.a.F9f,ta.a.frame,this.ilc),this.Ma.ji(Xa.a.$Ub,ta.a.frame,Object(f.a)(this,this.$Ub,"queryPolicyShortLabel"),96));this.Ma.hf(Xa.a.F2a,ta.a.frame,Object(f.a)(this,this.F2a,"toggleSensitivity"));this.Ma.hf(Xa.a.MHa,ta.a.frame,Object(f.a)(this,this.MHa,"populateSensitivityFlyout"));this.Ma.hf(Xa.a.setSensitivity,ta.a.frame,Object(f.a)(this,this.setSensitivity,"setSensitivity"));this.Ma.ji(Xa.a.Jlb,ta.a.frame,Object(f.a)(this,this.Jlb,"querySensitivity"),96);this.Ma.hf(Xa.a.D1,ta.a.frame,
Object(f.a)(this,this.D1,"querySensitivityToggleButton"));this.Ma.hf(Xa.a.z7,ta.a.frame,Object(f.a)(this,this.z7,"querySensitivitySubFlyout"));this.iyb(Xa.a.F2a)||this.Ma.Wnb(Xa.a.F2a,4);this.iyb(Xa.a.MHa)||this.Ma.Wnb(Xa.a.MHa,4);this.iyb(Xa.a.setSensitivity)||this.Ma.Wnb(Xa.a.setSensitivity,4);this.iyb(Xa.a.D1)||this.Ma.Wnb(Xa.a.D1,4);this.iyb(Xa.a.z7)||this.Ma.Wnb(Xa.a.z7,4);this.ej.px();w.AFrameworkApplication.fa&&W.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&
this.Nj.value.FVj(Object(f.a)(this,this.Nhg,"registerActionsHandler"))}Nhg(){this.ik()}WRc(){this.Ma.LB(Xa.a.xXd,ta.a.frame,this.ilc);this.Ma.LB(Xa.a.Ilb,ta.a.frame,Object(f.a)(this,this.Ilb,"queryPolicyLabel"));this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Ma.LB(Xa.a.F9f,ta.a.frame,this.ilc),this.Ma.LB(Xa.a.$Ub,ta.a.frame,Object(f.a)(this,this.$Ub,"queryPolicyShortLabel")));this.Ma.LB(Xa.a.F2a,ta.a.frame,Object(f.a)(this,this.F2a,"toggleSensitivity"));
this.Ma.LB(Xa.a.MHa,ta.a.frame,Object(f.a)(this,this.MHa,"populateSensitivityFlyout"));this.Ma.LB(Xa.a.setSensitivity,ta.a.frame,Object(f.a)(this,this.setSensitivity,"setSensitivity"));this.Ma.LB(Xa.a.Jlb,ta.a.frame,Object(f.a)(this,this.Jlb,"querySensitivity"));this.Ma.LB(Xa.a.D1,ta.a.frame,Object(f.a)(this,this.D1,"querySensitivityToggleButton"));this.Ma.LB(Xa.a.z7,ta.a.frame,Object(f.a)(this,this.z7,"querySensitivitySubFlyout"))}F2a(){return 32}pmf(mb){const Oc="mandatoryLabelling_"+mb.Id;this.Ize[Oc]=
mb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Oc,["label"]:mb.DisplayName,["hideLabel"]:!1,["customTooltip"]:mb.Tooltip}}HWa(){return this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}gJd(){return this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)}Zqi(){const mb=[];for(const ud in this.wO){var Oc=void 0,jd=void 0;Fa(this.Fa)?(Oc=this.wO[ud],jd=this.np[ud]):(jd=ud,Oc=this.wO[ud],jd=this.np[jd]);if(jd&&jd.Enabled&&!jd.HasUserDefinedPermissions)if(Oc.count){const pd=
{["sections"]:[],["shouldAutoOpen"]:!1},id={["id"]:"mandatoryLabelling_flyoutMenuSection_"+jd.Id,["controls"]:[]};for(const Ed of Oc)(Oc=this.np[Ed])&&Oc.Enabled&&!Oc.HasUserDefinedPermissions&&Array.add(id.controls,this.pmf(Oc));Array.add(pd.sections,id);Array.add(mb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+jd.Id,["label"]:jd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:pd})}else Array.add(mb,this.pmf(jd))}return mb}MHa(mb,Oc,jd,ud,pd){if(1===
jd||!this.Nj.value.Loa(!0))return 32;pd.MenuItems=Object.assign(new Ba.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(pd.MenuItems.MenuSectionList,this.Tf(!this.isReactRibbonEnabled()));this.zi.CustomUrl&&Array.add(pd.MenuItems.MenuSectionList,this.xIh(this.isReactRibbonEnabled()?this.zi.CustomUrl:R.a.Eh(this.zi.CustomUrl)));this.isReactRibbonEnabled()||(pd.PopulationXML=Q.q(pd.MenuItems));return 32}Jlb(mb,Oc,jd,ud,pd){if(1===jd||!pd||!this.pvc)return 32;this.zi=this.Nj.value.an;
if(this.Nj.value.Loa(!0)&&(pd[L.visible]=!0,this.Txe||(ia.a("MipLabelsAvailable"),this.Txe=!0),this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&!this.Fa.getBooleanFeatureGate("Microsoft.Office.WordOnline.CEBlockPopupEnabled",!1)&&this.zi&&this.zi.AreLabelsAvailable&&(mb=qa.a.instance.We("Common.ISystemInitiatedFeedback"))))if(Fa(this.Fa)){const id=this.zi.AppliedPolicyId?"LouderLabel_LabelExistsOnLoadActivity":"LouderLabel_NoLabelAppliedOnLoadActivity";mb.execute(Ed=>
{Ed.logActivity(id,null)})}else{const id=La.$j(this.zi.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";mb.execute(Ed=>{Ed.logActivity(id,null)})}return 32}D1(mb,Oc,jd,ud,pd){if(1===jd||!pd)return 32;let id,Ed;pd[L.gGg]=!!(id=pd[L.menuItemId])&&!!(Ed=this.Evb[id])&&Ed===this.zi.AppliedPolicyId;return 32}z7(mb,Oc,jd,ud,pd){if(1===jd||!pd)return 32;let id,Ed,Pd;mb=!!(id=pd[L.NI])&&!!(Ed=this.Evb[id])&&!!(Pd=this.wO[Ed])&&Pd.contains(this.zi.AppliedPolicyId);
pd[L.ebi]=mb;pd[L.gGg]=mb;return 32}setSensitivity(mb,Oc,jd,ud,pd){if(1===jd||!pd)return 32;mb=this.Evb[pd[L.NI]];Oc=this.xAk(pd[L.wAk]);jd=new oa.a;jd.name="SensitivityPickerLocation";jd.int64=Oc;ia.a("SensitivityPickerUsage",void 0,void 0,[jd]);return this.hJa(mb,pd,2)}Wvc(){return!!w.AFrameworkApplication.ra&&1===w.AFrameworkApplication.ra.mode}cHg(){this.zi.DefaultLabelId&&this.zi.MandatoryLabelingEnforced?this.NYc||this.Wvc()?this.zi.AppliedPolicyId?this.Qqd(""):(this.Nj.value.q0i(this.Nj.value.pPb)||
this.Wvc())&&this.kaf():this.Vtg():this.zi.DefaultLabelId?this.Vtg():this.zi.MandatoryLabelingEnforced&&(this.zi.AppliedPolicyId?this.Qqd(""):this.kaf())}fIf(){return this.zi.MandatoryLabelingEnforced?this.zi&&this.zi.AreLabelsAvailable?this.Fa.la("TestOverrideIsReactDialogEnabled")||this.ej&&this.ej.Pa&&this.ej.Pa.cA?!0:(l.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(l.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),
!1):(l.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}kaf(){!this.fIf()||w.AFrameworkApplication.bca||this.Hze||(this.Hze=w.AFrameworkApplication.bca=!0,l.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Nj.value.Ueg("",1),this.Nj.value.Had(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,
()=>{this.Pcj()}))}Qqd(mb){this.fIf()&&w.AFrameworkApplication.bca&&(w.AFrameworkApplication.bca=!1,l.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Nj.value.o3d(),this.Nj.value.Ueg(mb,2))}Pcj(){K.instance.JIh(this.Zqi(),this.zi.CustomUrl,this.Qcj)}zSe(){return this.Fa.la("CoAuthForProtectedFilesEnabled")&&this.Fa.la("SupportsOfficeClientCoauthoring")&&this.Fa.la("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.xte&&this.ogb}hJa(mb,Oc,jd,ud=null){this.Nj.value.iMj(jd);
let pd=32,id=!1,Ed=!0;const Pd=2===jd||8===jd||16===jd,lc=mb===this.zi.AppliedPolicyId;if(this.RWc&&this.RWc(mb,Pd))l.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",jd),this.ej.px();else if(Oc&&L.Wcd in Oc&&this.Nj.value.Hak(Oc[L.Wcd]),mb)if(this.Nj.value.tKf()||this.zSe()&&this.x2c)l.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
jd),this.ej.px(),Pd&&this.edc(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.Fa.la("HasDocumentEditRights"))if(this.Nj.value.Duh(mb))if(!this.HWa()&&this.np[mb]&&this.np[mb].HasUserDefinedPermissions&&!lc)l.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",jd),1!==jd&&4!==jd&&this.Nhh();else if(Pd&&this.zi.MandatoryLabelingEnforced&&lc)l.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",jd),this.edc(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Pd&&this.Fa.la("WacLabelingJustificationDialogIsEnabled")&&this.zi.RequiredDowngradeJustification&&(lc||this.np[mb].RequiredDowngradeJustification)&&(this.HWa()?!this.Jwe&&!ud:!this.J5a))return l.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
jd),this.Dce(mb),pd;if(this.HWa()&&this.np[mb].HasUserDefinedPermissions&&!lc)return l.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",jd),this.dde(mb,ud),pd;if(this.zSe()&&!this.xte())this.DWc<this.UVg?(l.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.DWc,jd),this.x2c=!0,this.DWc++,Za.Task.delay(this.VVg).continueWith(()=>{this.x2c=!1;this.hJa(mb,Oc,jd)})):(l.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",jd),id=1!==jd,Ed=!1,pd=8);else{if(this.RZi(mb)&&(l.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",jd),1===jd||8===jd||4===jd))return pd;l.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",jd);this.U0a(lc?"":mb,this.HWa()?ud:this.J5a,jd);return pd}}else l.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",jd),this.ej.px(),Pd&&this.edc(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else l.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",jd),this.ej.px(),Pd&&this.edc(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else l.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",jd),this.ej.px(),id=Pd,Ed=!1,pd=8;this.Nj.value.X0d(0,jd,id,Ed);return pd}E8a(mb,Oc,jd=null,ud=!1){ka.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",ha.b.FailureBased,"wordclpfc",null);this.Fa.la("SupportsOfficeClientCoauthoring")&&this.Fa.la("CoAuthForProtectedFilesIsEnabled")?(this.Rub=!1,(this.zi=this.Nj.value.an)&&!this.zi.AppliedPolicyId?this.Rub=!0:
this.zi&&this.zi.PolicyLabelAssignmentMethod&&(this.Rub=za.e(this.zi.PolicyLabelAssignmentMethod)===za.e("standard"))):this.Rub=ud;Fa(this.Fa)?(mb=mb?this.np[mb]:null,Oc=Oc?this.np[Oc]:null):(mb=La.$j(mb)?null:this.np[mb],Oc=La.$j(Oc)?null:this.np[Oc]);Oc?this.yna=new v(Oc,!0,jd):(this.Nj.value.ala(29),this.Hma=null);mb?this.Kxa=new v(mb,!1):this.A4a=null;this.U_d(null,null);return 32}Ujh(mb){""!==this.zi.AppliedPolicyId?this.Nj.value.X0d(14,16,!0):this.hJa(mb,null,16)}Jug(){this.np={};if(this.zi=
this.Nj.value.an)for(const mb of this.zi.SensitivityLabels)this.np[mb.Id]=mb}RZi(mb){if(this.wO&&mb in this.wO){mb=this.wO[mb];for(const Oc of mb)if((mb=this.np[Oc])&&mb.Enabled)return!0}return!1}uvg(){this.wO={};if(this.zi=this.Nj.value.an){for(const mb of this.zi.SensitivityLabels)mb.ParentId||(this.wO[mb.Id]=new t.a);for(const mb of this.zi.SensitivityLabels)this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1)?mb.ParentId&&mb.ParentId in this.wO&&
(this.np[mb.ParentId]&&(mb.ParentName=this.np[mb.ParentId].DisplayName),mb.Enabled&&this.wO[mb.ParentId].add(mb.Id)):mb.ParentId&&mb.ParentId in this.wO&&mb.Enabled&&this.wO[mb.ParentId].add(mb.Id)}}leg(){this.zi=this.Nj.value.an;const mb=this.pvc&&this.isReactRibbonEnabled()&&this.Nj.value.Loa();La.NJc(mb)}cQj(mb){this.RWc=mb}WQj(mb){this.t2c=mb}Vtg(){if(this.Fa.la("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Wvc())this.c2c=!0;else if(!this.NYc&&(this.NYc=!0,(this.zi=this.Nj.value.an)&&this.zi.DefaultLabelId))if(!this.zi.AppliedPolicyId)l.ULS.sendTraceTag(509732190,
306,50,"Default labeling triggered. DefaultLabelType: {0}",this.zi.DefaultLabelType),this.hJa(this.zi.DefaultLabelId,null,1);else if(u.a.Ki().equals(this.zi.DefaultLabelType,"documentLibraryDefault")){const mb=this.np[this.zi.AppliedPolicyId],Oc=this.np[this.zi.DefaultLabelId];this.zi.AppliedPolicyId!==this.zi.DefaultLabelId&&u.a.Ki().equals(this.zi.PolicyLabelAssignmentMethod,"standard")&&mb.Order<Oc.Order&&(l.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",
this.zi.DefaultLabelType),this.hJa(this.zi.DefaultLabelId,null,1))}}U0a(mb,Oc,jd=2){this.HWa()?Oc&&(this.Jwe=!0):this.J5a=Oc;this.Nj.value.U0a(mb);this.ej.px();jd=new y(jd,this.Fdb(this.np[mb]));this.Nj.value.OMc(mb,this.HWa()?Oc:this.J5a,jd)}Dce(mb){(new O(mb,this.uDh)).Dce()}dde(mb,Oc){(new X(mb,Oc,this.vDh)).dde()}edc(mb="",Oc=""){const jd=new da.StandardDialog;jd.ay=w.AFrameworkApplication.$Lb;jd.Ye=0;jd.uf(1,CommonUIStrings.l_DialogClose);jd.$X(mb,Oc,null)}Nhh(){const mb=new da.StandardDialog;
mb.ay=w.AFrameworkApplication.$Lb;mb.Ye=1;mb.uf(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);mb.uf(0,CommonUIStrings.l_DialogClose);mb.$X(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,this.aoh)}isReactRibbonEnabled(){return!!this.ej&&!!this.ej.Pa&&this.ej.Pa.zn}An(){return this.ej&&this.ej.Pa?this.ej.Pa.An:!1}Gbk(mb,Oc,jd,ud){mb?(ud[L.value]=mb,ud[L.xl]=mb,ud[L.customTooltip]=Oc,this.Rug(jd,w.AFrameworkApplication.protectedFile,
ud)):(ud[L.iconColor]=L.wRc,this.zi.MandatoryLabelingEnforced?(ud[L.value]=ud[L.xl]=this.mrc().z8d,ud[L.icon]=L.oNj):(ud[L.value]=ud[L.xl]=this.mrc().pTd,ud[L.icon]=L.rNj));ud[L.visible]=!0}vak(mb){let Oc="",jd="",ud="";if(this.zi.AreLabelsAvailable){let pd=null;this.np&&(pd=this.np[this.zi.AppliedPolicyId]);pd&&(Oc=this.Fdb(pd),jd=pd.Tooltip,this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)||(w.AFrameworkApplication.protectedFile=this.Nj.value.xFa(pd)),
ud=this.Gwd(pd));if(!this.Nj.value.Loa()&&!pd)return}else{if(!this.XMa)return;Oc=this.XMa;ud=L.wRc;jd=this.$ub?this.$ub:""}this.Gbk(Oc,jd,ud,mb)}Ilb(mb,Oc,jd,ud,pd){if(1===jd)return 32;this.zi=this.Nj.value.an;if(!this.zi||!pd)return 32;pd[L.value]="";pd[L.xl]="";pd[L.alt]=null;pd[L.xBf]=null;pd[L.$ra]=null;pd[L.customTooltip]="";pd[L.visible]=!1;pd[L.iconColor]="";pd[L.icon]="";if(this.gJd())this.vak(pd);else{jd=Oc=mb="";if(!this.zi.AreLabelsAvailable){if(!this.XMa)return 32;mb=this.XMa;jd=L.wRc;
this.$ub&&(Oc=this.$ub)}else if(this.zi.AppliedPolicyId){ud=null;for(const id of this.zi.SensitivityLabels)if(id.Id.toLowerCase()===this.zi.AppliedPolicyId.toLowerCase()){ud=id;break}ud&&(mb=this.Fdb(ud),Oc=ud.Tooltip,this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)||(w.AFrameworkApplication.protectedFile=this.Nj.value.xFa(ud)),jd=this.Gwd(ud))}mb&&(pd[L.value]=mb,pd[L.xl]=mb,this.An()?pd[L.customTooltip]=Oc:pd[L.alt]=Oc,this.Rug(jd,w.AFrameworkApplication.protectedFile,
pd),pd[L.visible]=!0)}return 32}$Ub(mb,Oc,jd,ud,pd){if(1===jd)return 32;this.zi=this.Nj.value.an;if(!this.zi||!pd)return 32;pd[L.xl]="";if(this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",!1)&&this.zi.HideBarByDefault)return 32;mb="";if(this.zi.AreLabelsAvailable)if(this.zi.AppliedPolicyId){if(!this.np)return 32;(Oc=this.np[this.Nj.value.an.AppliedPolicyId])&&(mb=Oc.ParentId&&this.np[Oc.ParentId]?this.np[Oc.ParentId].DisplayName:Oc.DisplayName)}else mb=this.zi.MandatoryLabelingEnforced?
this.mrc().z8d:this.mrc().pTd;else{if(!this.XMa)return 32;mb=this.XMa}pd[L.xl]=mb;return 32}Fdb(mb){return mb?this.np?mb.ParentId&&this.np[mb.ParentId]?this.np[mb.ParentId].DisplayName+"\\"+mb.DisplayName:mb.DisplayName:(l.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),mb.DisplayName):""}Rug(mb,Oc,jd){this.gJd()?(jd[L.icon]=this.Ruf(Oc),jd[L.iconColor]=this.VAd(mb)):this.An()?jd[L.icon]=Oc?L.Aqk:L.Cqk:(jd[L.xBf]=w.AFrameworkApplication.Vw,jd[L.$ra]=
Oc?z.getImageClass(L.Bqk):z.getImageClass(L.Dqk))}xIh(mb){const Oc=this.JV("LearnMoreSection",!0);mb=Fa(this.Fa)?Object.assign(new ba.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:mb,LabelText:CommonUIStrings.l_LearnMore,Command:Xa.a.openUrlInNewTab.toString(),Image16by16:w.AFrameworkApplication.Vw,Image16by16Class:z.getImageClass(L.wOf),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"}):Object.assign(new ba.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",
MenuItemId:mb,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:w.AFrameworkApplication.Vw,Image16by16Class:z.getImageClass(L.wOf),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Oc.ControlList,mb);return Oc}l4e(mb,Oc,jd=!1){let ud;ud="Toggle_"+mb.Id;ud="Sensitivity_"+ud;const pd=mb.DisplayName,id=mb.Tooltip;var Ed=mb.Id===this.zi.AppliedPolicyId,Pd=jd?R.a.Eh(ud):ud;this.gJd()?(Ed=this.Gwd(mb),Oc=Fa(this.Fa)?Object.assign(new S.a,{Id:Pd,ExternalId:Pd,
LabelText:jd?R.a.Eh(pd):pd,Command:Xa.a.setSensitivity.toString(),MenuItemId:Pd,QueryCommand:Xa.a.D1.toString(),Visible:!0,Alt:jd?R.a.Eh(id):id,AriaLabel:aa.a.FPa,IconColor:this.VAd(Ed),KeyTip:Oc}):Object.assign(new S.a,{Id:Pd,ExternalId:Pd,LabelText:jd?R.a.Eh(pd):pd,Command:"2935633379",MenuItemId:Pd,QueryCommand:"991261903",Visible:!0,Alt:jd?R.a.Eh(id):id,AriaLabel:aa.a.FPa,IconColor:this.VAd(Ed),KeyTip:Oc}),Oc.ExternalImageId=this.Ruf(this.Nj.value.xFa(mb))):(Pd=Fa(this.Fa)?Object.assign(new T.a,
{Id:Pd,ExternalId:Pd,LabelText:jd?R.a.Eh(pd):pd,Command:Xa.a.setSensitivity.toString(),MenuItemId:Pd,QueryCommand:Xa.a.D1.toString(),CheckedImage:w.AFrameworkApplication.Vw,Visible:!0,Alt:jd?R.a.Eh(id):id,IsChecked:Ed,AriaLabel:aa.a.FPa,KeyTip:Oc}):Object.assign(new T.a,{Id:Pd,ExternalId:Pd,LabelText:jd?R.a.Eh(pd):pd,Command:"2935633379",MenuItemId:Pd,QueryCommand:"991261903",CheckedImage:w.AFrameworkApplication.Vw,Visible:!0,Alt:jd?R.a.Eh(id):id,IsChecked:Ed,AriaLabel:aa.a.FPa,KeyTip:Oc}),this.isReactRibbonEnabled()?
(Pd.CheckedImageClass=z.getImageClass(L.i1d),Pd.ExternalImageId=L.i1d):Pd.CheckedImageClass=z.getImageClass(L.gCb),Oc=Pd);Pd=ud;this.Evb[Pd]=mb.Id;this.FCe[mb.Id]=Pd;return Oc}JV(mb,Oc=!1){return Object.assign(new va.a,{Title:"",Id:mb,DisplayMode:L.menu,ShowMenuSectionSeparator:Oc,ControlsId:"Ctrl_"+mb,ControlList:[]})}zLh(mb,Oc,jd){mb=this.JV(mb+"Sub");let ud=1;for(const pd of Oc)(Oc=this.np[pd])&&Oc.Enabled&&(Array.add(mb.ControlList,this.l4e(Oc,ud.toString(),jd)),ud++);return mb}Tf(mb=!1){const Oc=
this.JV("SensitivitySection");let jd=1;for(const pd in this.wO){let id;var ud=void 0;Fa(this.Fa)?(id=this.wO[pd],ud=this.np[pd]):(ud=pd,id=this.wO[pd],ud=this.np[ud]);if(ud&&ud.Enabled){if(id.count){const Ed="Label"+this.FXg++;let Pd;Pd=Fa(this.Fa)?Object.assign(new P.a,{Id:Ed,ExternalId:Ed,LabelText:mb?R.a.Eh(ud.DisplayName):ud.DisplayName,Command:Xa.a.alwaysEnabled.toString(),QueryCommand:Xa.a.z7.toString(),Menu:Object.assign(new Ba.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,
Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:aa.a.FPa,KeyTip:jd.toString(),Alt:mb?R.a.Eh(ud.Tooltip):ud.Tooltip}):Object.assign(new P.a,{Id:Ed,ExternalId:Ed,LabelText:mb?R.a.Eh(ud.DisplayName):ud.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new Ba.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:aa.a.FPa,KeyTip:jd.toString(),Alt:mb?R.a.Eh(ud.Tooltip):ud.Tooltip});this.isReactRibbonEnabled()?
Pd.ExternalImageId=L.i1d:(Pd.Image16by16=w.AFrameworkApplication.Vw,Pd.Image16by16Class=z.getImageClass(L.gCb));Array.add(Pd.Menu.MenuSectionList,this.zLh(Ed,id,mb));Array.add(Oc.ControlList,Pd);this.Evb[Pd.Id]=ud.Id;this.FCe[ud.Id]=Pd.Id}else Array.add(Oc.ControlList,this.l4e(ud,jd.toString(),mb));jd++}}return Oc}iyb(mb){return!!this.Ma.gba(mb)&&!!this.Ma.gba(mb).flags&&!!this.Ma.gba(mb).flags.length}Ruf(mb){return mb?L.qNj:L.pNj}VAd(mb){return mb?mb:L.wRc}Gwd(mb){if(mb.Color||!mb.ParentId)return mb.Color;
const Oc=this.np[mb.ParentId];return Oc?Oc.Color:mb.Color}xAk(mb){switch(mb){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}mrc(){this.M5c||(this.M5c=Object.assign(new C,{pTd:HeaderStrings.NoSensitivityLabel,z8d:HeaderStrings.SelectASensitivityLabel}));return this.M5c}static ZFk(){w.AFrameworkApplication.fa&&!w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||!W.c()||appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",
!0))}static NJc(mb){W.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!mb))}static $j(mb){return mb&&mb.length?!1:!0}}Object(n.a)(La,"PolicyActor",null,[213]);var xa=a(692),db=a(1083),bb=a(109),kb;(function(mb){mb[mb.unknown=0]="unknown";mb[mb.vPk=1]="boot";mb[mb.refresh=2]="refresh";mb[mb.SYk=3]="selfSetPolicyLabel"})(kb||(kb={}));Object(n.b)("GetPolicyLabelsReason",kb);class Rb extends Sys.EventArgs{constructor(mb,Oc,jd,ud,pd,id){super();this.mBb=mb;this.title=
Oc;this.message=jd;this.buttonText=ud;this.Oga=pd;this.MNb=id}}Object(n.a)(Rb,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class zb extends Sys.EventArgs{constructor(mb,Oc,jd,ud,pd){super();this.mBb=mb;this.title=Oc;this.message=jd;this.buttonText=ud;this.Oga=pd}}Object(n.a)(zb,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var nc;(function(mb){mb[mb.none=0]="none";mb[mb.reasonDefaultLabel=1]="reasonDefaultLabel";mb[mb.reasonManual=2]="reasonManual";mb[mb.reasonAutomatic=
4]="reasonAutomatic";mb[mb.reasonRecommended=8]="reasonRecommended";mb[mb.reasonMandatory=16]="reasonMandatory";mb[mb.reasonAI=32]="reasonAI"})(nc||(nc={}));Object(n.b)("ApplyLabelFlags",nc);class Zb extends Sys.EventArgs{constructor(mb,Oc,jd){super();this.kZe=mb;this.jZe=Oc;this.existingLabelPriority=jd}}Object(n.a)(Zb,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Sa extends Sys.EventArgs{constructor(){super()}}Object(n.a)(Sa,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class Na extends Sys.EventArgs{constructor(){super()}}
Object(n.a)(Na,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Ea{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=this.PostponeMandatoryBeforeSave=this.FullControlEnabled=this.MacrosEnabled=this.ExportEnabled=this.SaveEnabled=this.PrintEnabled=
this.ExtractEnabled=this.EditEnabled=this.ViewEnabled=this.HideBarByDefault=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl="";this.PostponeMandatoryBeforeSave=this.FullControlEnabled=this.MacrosEnabled=this.ExportEnabled=this.SaveEnabled=this.PrintEnabled=this.ExtractEnabled=this.EditEnabled=this.ViewEnabled=
this.HideBarByDefault=!1}}Object(n.a)(Ea,"GetPolicyLabelsData",null,[]);class Aa extends Sys.EventArgs{constructor(mb=!1,Oc=null,jd=null,ud=null){super();this.nX=mb;this.jdd=Oc;this.context=jd;this.Bvg=ud}}Object(n.a)(Aa,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Ka extends Sys.EventArgs{constructor(mb,Oc){super();this.uGa=mb;this.rPe=Oc}}Object(n.a)(Ka,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class nb extends Sys.EventArgs{constructor(mb,Oc,jd,ud){super();this.title=mb;this.wGc=
Oc;this.buttonText=jd;this.HZf=ud}}Object(n.a)(nb,"PolicyTipEventArgs",Sys.EventArgs,[]);class Qb extends Sys.EventArgs{constructor(mb,Oc){super();this.mBb=mb;this.MNb=Oc}}Object(n.a)(Qb,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class jb extends Sys.EventArgs{constructor(){super()}}Object(n.a)(jb,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class qb extends Sys.EventArgs{constructor(mb,Oc){super();this.vGc=mb;this.PR=Oc}}Object(n.a)(qb,"SetPolicyLabelEventArgs",
Sys.EventArgs,[]);class ab extends Sys.EventArgs{constructor(mb,Oc,jd,ud=null,pd=null,id=null,Ed=null){super();this.errorType=mb;this.Qzg=jd;this.title=ud;this.message=pd;this.buttonText=id;this.Oga=Ed}}Object(n.a)(ab,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class xb extends Sys.EventArgs{constructor(){super()}}Object(n.a)(xb,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class Tb extends Sys.EventArgs{constructor(mb){super();this.mhk=mb}}Object(n.a)(Tb,"UDPLabelingAppHandlerEventArgs",
Sys.EventArgs,[]);var Cc=a(77),lb=a(215),Ya=a(90);class Hb{constructor(mb,Oc,jd,ud,pd,id,Ed,Pd=null,lc=null,Kc=!1,td=null,zd=null,me=null,Ae=null,ze=!1,Ne=null,hf=null,rf=null,df=null,Af=null,Pc=null){this.url=mb;this.AJk=Oc;this.body=jd;this.headers=ud;this.Mob=pd;this.priority=id;this.state=Ed;this.JOg=Pd;this.NB=lc;this.dT=Kc;this.VKj=td;this.r7j=zd;this.name=me;this.JFc=Ae;this.Aud=ze;this.j$f=Ne;this.nnc=hf;this.evc=rf;this.bnb=df;this.DJi=Af;this.responseType=Pc}}Object(n.a)(Hb,"ClientRequest",
null,[]);var Lb=a(116),qc=a(106),mc=a(44),Ta=a(55),Va=a(232);class Db{static d$j(mb,Oc){if(!mb||!Oc||mb.count!==Oc.count)return!1;for(const jd of mb)if(!Oc.contains(jd))return!1;return!0}static toArray(mb){if(!mb)return null;const Oc=Array(mb.count);let jd=0;for(const ud of mb)Oc[jd]=ud,jd++;return Oc}}Object(n.a)(Db,"HashSetUtils",null,[]);class Ca{constructor(mb,Oc,jd,ud=0,pd=null){this.MYc=this.Ose=null;this.yza=this.dub=this.fub=0;this.eC="";this.XNa=this.vWc=this.hwe=this.Gxa=this.x3c=null;this.Kwe=
!1;this.rLa=null;this.q0c=0;this.c9b=this.ZNa=this.xMa=this.b9b=null;this.Za=new bb.a;this.gZb=this.bJb=this.Ur=null;this.g1c=!1;this.pPb=null;this.Fa=mb;this.xk=Oc;this.ek=jd;this.c8b=ud;this.an=new Ea;this.gAk();this.ECe=this.Fa.Ta("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.KU=pd;this.pvc=mb.la("WacApplyManualPolicyLabelIsEnabled");this.Fvc=mb.la("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=mb.la("SupportsOfficeClientCoauthoring");this.m1i=!1;this.xbk=3E4;
this.sh=qc.TaskManager.instance;mb.la("SupportsPolicies")&&ia.a("MipSupportsPolicies");this.Fvc&&this.supportsOfficeClientCoauthoring&&ia.a("MipSupportsOfficeClientCoauthoring")}get IGd(){return this.g1c}eNe(mb){this.Za.addHandler("PolicyTipEvent",mb)}hzb(mb){this.Za.addHandler("LabelInfoUpdateEvent",mb)}FVj(mb){this.Za.removeHandler("LabelInfoUpdateEvent",mb)}qNe(mb){this.Za.addHandler("SetPolicyLabelEventKey",mb)}YWj(mb){this.Za.removeHandler("SetPolicyLabelEventKey",mb)}acd(mb){this.Za.addHandler("SetPolicyLabelFailureEventKey",
mb)}XWj(mb){this.Za.removeHandler("SetPolicyLabelFailureEventKey",mb)}$dh(mb){this.Za.addHandler("GetPolicyLabelEventKey",mb)}Zdh(mb){this.Za.addHandler("GetPolicyLabelFailureEventKey",mb)}Xdh(mb){this.Za.addHandler("GetAutoPolicyLabelEventKey",mb);this.IGd&&(l.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.L0d(new Sa(0)))}eVj(mb){this.Za.removeHandler("GetAutoPolicyLabelEventKey",mb)}pdh(mb){this.Za.addHandler("CreateAutoCLPSecurityNodesEventKey",
mb)}EUj(mb){this.Za.removeHandler("CreateAutoCLPSecurityNodesEventKey",mb)}ogh(mb){this.Za.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",mb)}iXj(mb){this.Za.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",mb)}pgh(mb){this.Za.addHandler("UpdateAutoCLPSITNodesEventKey",mb)}jXj(mb){this.Za.removeHandler("UpdateAutoCLPSITNodesEventKey",mb)}TLe(mb){this.Za.addHandler("AddAutoPolicyBusinessBarEntryEventKey",mb)}UTj(mb){this.Za.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",mb)}hNe(mb){this.Za.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
mb)}AWj(mb){this.Za.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",mb)}ULe(mb){this.Za.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",mb)}WTj(mb){this.Za.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",mb)}iNe(mb){this.Za.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",mb)}BWj(mb){this.Za.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",mb)}Keh(mb){this.Za.addHandler("MandatoryLabellingAppHandlerEventKey",mb)}OVj(mb){this.Za.removeHandler("MandatoryLabellingAppHandlerEventKey",
mb)}mgh(mb){this.Za.addHandler("UDPLabelingAppHandlerEventKey",mb)}hXj(mb){this.Za.removeHandler("UDPLabelingAppHandlerEventKey",mb)}get eId(){if(!this.Ose)return!1;for(const mb of this.Ose.zQk())if(!mb.Capabilities||!mb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get E0i(){return!!this.Ur}Ywh(){return this.hwe?this.hwe():!1}YPj(mb){this.vWc=mb}fB(){return(new Date).getTime()}z6(){return this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",
!1)}eqc(){this.ek&&(this.b9b=this.ek.Sf("WebServiceCall","Call Get Policy Endpoint On Server"));var mb=lb.a.Mpa(1,1);this.Fa.la("SendHostAttributionInfoForPolicyLabelEnabled")?(mb=new Hb(this.DUb("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,mb),this.xk.send(mb).p2d(Object(f.a)(this,this.e0f,"onDataLossPolicySuccessCallback"),Object(f.a)(this,this.d0f,"onDataLossPolicyFailureCallback"))):this.xk.ir(this.DUb("datalosspolicy"),
1,null,null,!0,2,Object(f.a)(this,this.e0f,"onDataLossPolicySuccessCallback"),Object(f.a)(this,this.d0f,"onDataLossPolicyFailureCallback"),null);this.fub++;l.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.ECe,this.fub)}APj(){this.pxd(this.eC,2,this.Gxa)}pxd(mb,Oc=0,jd=null,ud=!1,pd=null){ka.Health.instance.recordKpiUsage("MipGetPolicyLabel",ha.b.FailureBased,"officewebclp",this.Gxd(void 0,Oc));this.bJb=this.fB();const id=
this.Bld(Oc);this.dqc(mb,id,jd,ud,Oc,pd);this.a5d(!0)}gAk(){this.V0g=!1}e0f(mb){this.Mag();let Oc="";({data:Oc}=this.Rhe(mb)).returnValue&&(l.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.fub=0,this.ek&&(this.c9b=this.ek.Sf("Task","Parse and Handle Get Policy Response")),this.JCj(Oc),this.c9b&&(this.c9b.stop(),this.c9b=null))}d0f(mb){this.Mag();this.fub<=this.c8b?this.eqc():(l.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",
mb?mb.data?mb.data.T_a:null:null),this.fub=0)}tKf(){return 0<this.yza}U0a(mb){this.an.AppliedPolicyId=mb}OMc(mb,Oc,jd=null,ud=null){const pd=this.aIh(jd);this.wbk(mb,Oc,pd,jd,ud)}r7f(mb){this.ZNa&&(this.ZNa.stop(),this.ZNa=null);const {Xrg:Oc,Cvg:jd,NB:ud}=this.Ztf(mb),pd=mb.data.state,id=pd?pd.PR:2;let Ed="";({data:Ed}=this.Rhe(mb)).returnValue?(l.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",id),this.yza=0,this.$Cj(Ed,Oc,jd,pd,ud)):this.Z6d(id,
ud)}iMj(mb){ka.Health.instance.recordKpiUsage("MipSetPolicyLabel",ha.b.FailureBased,"officewebclp",this.Gxd(mb));this.gZb=this.fB();l.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.Za.raiseEvent("SetPolicyLabelTriggeredEventKey",new xb(mb))}Iij(){this.Fvc&&this.supportsOfficeClientCoauthoring&&this.E0i&&this.Ur.Qda(12,null,!0)}q7f(mb){this.ZNa&&(this.ZNa.stop(),this.ZNa=null);const {Xrg:Oc,Cvg:jd,NB:ud}=this.Ztf(mb);if(this.yza<=this.c8b)this.OMc(Oc,jd,null,ud);
else{var pd=mb.data.state;pd=pd?pd.PR:2;l.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",mb?mb.data?mb.data.T_a:null:null,pd);this.pPb="WACServerConnectionFailed";this.yza=0;this.Z6d(pd,ud)}}q0i(mb){if(mb&&("LabelNotSupported"===mb||"LabelErrorRetryLater"===mb||"CoherencyFailure"===mb||"LabelIdNotFound"===mb||"LabelDisabled"===mb))return l.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",mb),!0;l.ULS.sendTraceTag(539103557,
306,50,"LabelError is not retriable: {0}",mb);return!1}xFa(mb){return this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPAsProtectedLabelEnabled",!1)?mb.IsEndpointProtectionEnabled||mb.HasUserDefinedPermissions:mb.IsEndpointProtectionEnabled}Duh(mb){if(!mb)return!1;let Oc=null,jd=null;for(const ud of this.an.SensitivityLabels)ud.Id===mb&&(Oc=ud),ud.Id===this.eC&&(jd=ud);if(!Oc)return!1;if(this.Fvc&&this.supportsOfficeClientCoauthoring){if(this.vWc&&this.vWc()||this.eId)return!0}else if(w.AFrameworkApplication.YD&&
w.AFrameworkApplication.YD.IHb||this.Gxa&&this.Gxa())return!0;return this.xFa(Oc)===(!!jd&&this.xFa(jd))}Eyb(mb,Oc,jd,ud,pd){28===mb?this.Beg(new Rb(mb,Oc,jd,ud,pd,!1)):this.Beg(new Rb(mb,Oc,jd,ud,pd,!0))}ala(mb){28===mb?this.ifg(new Qb(mb,!1)):this.ifg(new Qb(mb,!0))}kLj(mb,Oc,jd){l.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.Za.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new Zb(mb,Oc,jd))}oMj(mb){l.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");
this.Za.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new Zb(null,null,mb))}pMj(mb,Oc){l.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Za.raiseEvent("UpdateAutoCLPSITNodesEventKey",new Zb(mb,Oc,null))}Ueg(mb,Oc){l.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Oc?"Reading":"Edit")+" switch event.");this.Za.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Ka(mb,Oc))}Had(mb,Oc,jd,ud,pd){37===mb&&this.aLj(new zb(37,Oc,jd,ud,pd))}o3d(){this.bMj(new jb)}nMj(){l.ULS.sendTraceTag(540608322,
306,50,"Raising a UDP labeling event.");this.Za.raiseEvent("UDPLabelingAppHandlerEventKey",new Tb(!0))}Loa(mb=!1){const Oc=k(this.an);Oc||mb||La.NJc(!1);return Oc}O6j(){window.postMessage(JSON.stringify({type:"mipProperties",isProtected:w.AFrameworkApplication.protectedFile,sensitivity:{labelId:this.eC},usageRights:{docEdit:this.an.EditEnabled,extract:w.AFrameworkApplication.enableExtractForProtectedFile,print:w.AFrameworkApplication.printingEnabled,export:w.AFrameworkApplication.Slc,objModel:w.AFrameworkApplication.enableMacrosForProtectedFile,
owner:w.AFrameworkApplication.Tlc}}),"*")}wLj(mb,Oc){this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)&&this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableEdgeBlockScreenCapture",!1)&&Oc&&this.O6j();ka.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.kpc(void 0,mb,this.bJb));this.bJb=null;mb=new Sa(mb);this.xLj(mb);this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Oc&&this.Rfk()?this.IGd?
this.DCk():(this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.yDb(),this.L0d(mb),this.g1c=!0):Oc||this.AHc():!this.IGd&&Oc&&this.Fa.la("WacApplyManualPolicyLabelIsEnabled")&&this.LQe()?(this.L0d(mb),this.g1c=!0):Oc||this.AHc()}Jrj(mb){this.xMa&&(this.xMa.stop(),this.xMa=null);var Oc=null;mb&&mb.data&&(Oc=mb.data.NB);let jd;this.a5d(!1);({data:jd}=this.Rhe(mb)).returnValue?(l.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),
this.dub=0,Oc=this.PCj(jd,Oc),this.wLj(this.zsf(mb.data),Oc)):this.AHc()}Rfk(){if(!this.Fa.la("WacApplyManualPolicyLabelIsEnabled"))return l.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.LQe())return!1;if(""===this.eC)return l.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.rLa===this.q0c)return l.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),
!1;l.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}yDb(){this.gKg();l.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.XNa.count,this.rLa);const mb=Db.toArray(this.XNa);this.kLj(mb,mb,this.rLa)}DCk(){var mb=this.XNa;this.gKg();Db.d$j(mb,this.XNa)||(l.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.XNa.count),
mb=Db.toArray(this.XNa),this.pMj(mb,mb));this.Kwe&&(l.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.rLa),this.oMj(this.rLa))}gKg(){const mb=new xa.a(u.a.Ki());for(const Oc of this.an.SensitivityLabels)if(Oc&&Oc.AutoLabelingSensitiveTypeIds&&0<Oc.AutoLabelingSensitiveTypeIds.length)for(const jd of Oc.AutoLabelingSensitiveTypeIds)jd&&mb.add(jd);this.XNa=mb}Irj(mb){const Oc=this.zsf(mb.data);let jd=null;mb&&mb.data&&(jd=mb.data.NB);ka.Health.instance.recordKpiFailure("MipGetPolicyLabel",
"GetPolicyLabelsFailure",!1,!1,this.kpc(void 0,Oc,this.bJb));this.bJb=null;this.xMa&&(this.xMa.stop(),this.xMa=null);if(this.dub<=this.c8b){if(this.Fa.la("SendHostAttributionInfoForPolicyLabelEnabled")){const ud=mb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in ud&&ud[lb.a.dLc]&&"HostAttributionInfo.ScenarioTypeParamName"in ud&&ud[lb.a.UXb]){mb.data.request.get_headers();mb.data.request.get_headers()[lb.a.UXb];mb=this.Bld(Oc);this.dqc(this.eC,mb,this.Gxa,void 0,Oc,jd);return}}this.pxd(this.eC,
Oc,this.Gxa,!1,jd)}else l.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",mb?mb.data?mb.data.T_a:null:null),this.AHc(),this.dub=0,this.a5d(!1)}zsf(mb){return mb.state?mb.state:0}DUb(mb,Oc=!1){return c(this.Fa.Ta("PolicyHandlerWebServiceBase")||w.AFrameworkApplication.ra.Pa.g1,this.ECe,w.AFrameworkApplication.ml,"setpolicylabel"===mb&&w.AFrameworkApplication.YD&&w.AFrameworkApplication.YD.nGf,mb,Oc)}Ztf(mb){let Oc=null,jd=null,ud=null;mb&&mb.data&&mb.data.request&&
mb.data.request.get_headers()&&(Oc=mb.data.request.get_headers()[Ya.a.Yrg],jd=mb.data.request.get_headers()[Ya.a.Dvg],ud=mb.data.NB);return{Xrg:Oc,Cvg:jd,NB:ud}}Rhe(mb){mb=mb?mb.data?mb.data.responseData:null:null;return mb&&mb.length&&!this.h1i(mb)?{returnValue:!0,data:mb}:(l.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:mb})}JCj(mb){let Oc;try{Oc=mc.b(mb)}catch(jd){l.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");
return}if(Oc)if(Oc.IsPolicyTipAvailable)switch(Oc.IsPolicyTipAvailable.toLowerCase()){case "false":l.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":l.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.MYc=Oc.NavigateUrl;this.Glk(Oc.GeneralText,Object(f.a)(this,this.ioj,"onDataLossPolicyOverrideButtonClick"));break;default:l.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",
Oc.IsPolicyTipAvailable)}else l.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else l.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}qEh(mb){switch(mb){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;
case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}$Cj(mb,Oc,jd,ud,pd=null){var id=ud?ud.PR:2;let Ed=0;var Pd="";let lc;if(({ev:lc}=mc.d(mb)).returnValue)if(lc){Pd="Success";mb=this.Bld(3);if(lc.IsSuccessful){ka.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.kpc(id,
void 0,this.gZb));this.pPb=this.gZb=null;l.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",id);2===id&&this.ala(29);this.uck(Oc,id);this.Iij();this.ala(28);this.z6()?ud&&4===id&&(Pd=pd.startsWith("OFFICEJS_SENSITIVITY_CONTEXT_"),this.Eyb(28,Pd?"SENSITIVITY":CommonUIStrings.l_PolicyBusinessBarTitle,String.format(Pd?"Due to content created by Copilot, your organization automatically applied the sensitivity label: {0}.":
CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,ud.displayName),CommonUIStrings.l_DialogOk,()=>{})):ud&&4===id&&this.Eyb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,ud.displayName),CommonUIStrings.l_DialogOk,()=>{});ia.a("MipAppliedLabels",void 0,void 0,[Object.assign(new oa.a,{name:"SetPolicyLabelApplyFlag",string:nc[id]})]);this.dqc(Oc,mb,this.Gxa,void 0,3,pd);return}l.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
id,lc.FailureReason);this.pPb=lc.FailureReason;Ed=this.qEh(lc.FailureReason);this.m1i&&0<=lc.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(ud=new Lb.a(2,1,this.xbk,()=>{l.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.yza);this.yza<=this.c8b&&this.OMc(Oc,jd,null,pd)}),this.sh.Li(ud));this.Fvc&&this.supportsOfficeClientCoauthoring&&this.dqc(this.an.AppliedPolicyId,mb,this.Gxa,!0,3,pd)}else Pd=
"setPolicyLabelData null.",l.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",id);else Pd="TryDeserialize failed.",l.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",id);this.Z6d(id,pd,Ed);id=this.kpc(id,void 0,this.gZb);this.gZb=null;id.extendedProperties.set("SetPolicyLabelDataFailureReason",this.pPb);id.extendedProperties.set("SetPolicyLabelDataParseStatus",
Pd.toString());ka.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,id)}LIb(mb){if(""===mb)return null;for(const Oc of this.an.SensitivityLabels)if((null===Oc||void 0===Oc?void 0:Oc.Id)===mb)return Oc;return null}BCk(){if(""!==this.eC)for(const mb of this.an.SensitivityLabels)(null===mb||void 0===mb?void 0:mb.Id)===this.eC&&(mb.HasExtractForUser=this.xFa(mb)?this.an.ExtractEnabled:!0)}Z6d(mb,Oc=null,jd=0){const ud=2===mb||8===mb||16===mb,pd=new Aa;this.U0a(this.eC);
this.z6()&&(pd.jdd=this.LIb(this.eC),pd.context=Oc,pd.Bvg=jd);this.Seg(pd);this.X0d(jd,mb,ud,!1)}uck(mb,Oc){this.U0a(this.eC=mb);if(!this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1))if(""===mb)w.AFrameworkApplication.protectedFile=!1,w.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const jd of this.an.SensitivityLabels)if(jd.Id===mb){w.AFrameworkApplication.protectedFile=this.xFa(jd);break}this.hMj(new qb(mb,Oc))}GEk(){for(const mb of this.an.SensitivityLabels)if(null===
mb||void 0===mb?0:mb.Enabled)mb.Id===this.eC&&(this.Kwe=this.rLa!==mb.Order,this.rLa=mb.Order),mb.Order>this.q0c&&(this.q0c=mb.Order)}wFk(){this.Fa.appSettings&&(this.Fa.appSettings.AppliedPolicyId=this.eC);let mb=!1;if(""!==this.eC)for(const Oc of this.an.SensitivityLabels)if(Oc.Id===this.eC){mb=this.xFa(Oc);break}w.AFrameworkApplication.protectedFile=mb;w.AFrameworkApplication.JZa=mb?this.an.ViewEnabled&&!this.an.EditEnabled:!1;w.AFrameworkApplication.printingEnabled=mb?this.an.PrintEnabled:!1;
w.AFrameworkApplication.enableMacrosForProtectedFile=mb?this.an.MacrosEnabled:!1;w.AFrameworkApplication.enableExtractForProtectedFile=mb?this.an.ExtractEnabled:!1;w.AFrameworkApplication.Slc=mb?this.an.ExportEnabled:!1;w.AFrameworkApplication.Tlc=mb?this.an.FullControlEnabled:!1}bMi(mb,Oc){if(!mb)return l.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!mb.AreLabelsAvailable)return!1;this.an=mb;this.eC=mb.AppliedPolicyId;this.z6()&&this.BCk();
this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)?this.wFk():this.Fa.appSettings&&(this.Fa.appSettings.AppliedPolicyId=this.eC);this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.GEk();this.Loa()&&l.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");mb=new Aa(!0);this.z6()&&(mb.jdd=this.LIb(this.eC),mb.context=Oc);this.Seg(mb);return!0}PCj(mb,Oc=null){return({ev:mb}=
mc.d(mb)).returnValue?this.bMi(mb,Oc):(l.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1)}LQe(){if(!this.Loa())return l.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const mb of this.an.SensitivityLabels)if(mb&&mb.AutoLabelingSensitiveTypeIds&&0<mb.AutoLabelingSensitiveTypeIds.length)return!0;l.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");
return!1}Seg(mb){l.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Za.raiseEvent("LabelInfoUpdateEvent",mb)}xLj(mb){l.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Za.raiseEvent("GetPolicyLabelEventKey",mb)}AHc(){La.NJc(!1);this.Za.raiseEvent("GetPolicyLabelFailureEventKey",new Na)}L0d(mb){this.KU&&this.KU.execute(Oc=>{Oc=[Oc.isFeatureEnabled("MsoClpSpTwo",!0),Oc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Oc).then(jd=>{Va.a.any(jd,ud=>
ud)&&(l.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.Za.raiseEvent("GetAutoPolicyLabelEventKey",mb),this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.yDb(),ia.a("MipAutoClassificationEnabled"));return null})})}Gxd(mb=null,Oc=null){const jd=new Map;jd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=mb&&jd.set("ApplyLabelFlags",nc[mb]);null!=Oc&&jd.set("GetPolicyLabelsReason",kb[Oc]);return jd}kpc(mb=
null,Oc=null,jd=null){const ud={};ud.extendedProperties=this.Gxd(mb,Oc);null!=jd&&(ud.durationMs=this.fB()-jd);return ud}hMj(mb){l.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Za.raiseEvent("SetPolicyLabelEventKey",mb)}Beg(mb){l.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");mb&&mb.MNb&&ia.a("MipRecommendations");this.Za.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",mb)}ifg(mb){l.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");
this.Za.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",mb)}aLj(mb){l.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.Za.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",mb)}bMj(mb){l.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.Za.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",mb)}Glk(mb,Oc=null){l.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");
this.Za.raiseEvent("PolicyTipEvent",new nb(CommonUIStrings.l_PolicyBusinessBarTitle,mb,CommonUIStrings.l_PolicyOverrideButton,Oc))}X0d(mb,Oc,jd,ud=!0){l.ULS.sendTraceTag(42074656,306,ud?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Oc);ud=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let pd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,id=null,Ed=null;switch(mb){case 2:ud=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;
pd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:pd=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:ud=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;pd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:ud=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;pd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;
break;case 9:ud=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;pd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:pd=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:ud=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;pd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 15:ud=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,
pd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,id=CommonUIStrings.l_LearnMore,Ed=()=>{this.ybk()}}mb=new ab(mb,Oc,jd,ud,pd,id,Ed);this.Za.raiseEvent("SetPolicyLabelFailureEventKey",mb)}Hak(mb){this.x3c=mb}ioj(){this.MYc?(l.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),Ta.a.R_(this.MYc)):l.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}h1i(mb){if(!mb.startsWith("<")||-1===mb.indexOf("Error")&&
-1===mb.indexOf("Unavailable"))return!1;l.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}Mag(){this.b9b&&(this.b9b.stop(),this.b9b=null)}bgi(mb){if(!mb)return"manual";switch(mb.PR){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";case 32:return"ai";default:return"manual"}}khi(mb){if(!mb)return"privileged";
mb=mb.PR;let Oc="privileged";if(4===mb||1===mb||32===mb)Oc="standard";return Oc}dqc(mb,Oc,jd=null,ud=!1,pd=0,id=null){this.Fa.la("WacLabelingGetPolicyLabelsIsEnabled")&&(this.eC=mb,this.Gxa=jd,this.ek&&(this.xMa=this.ek.Sf("WebServiceCall","Call Get Policy Endpoint On Server")),m(this.Fa,this.xk,Object(f.a)(this,this.Jrj,"onGetPolicyLabelsSuccessCallback"),Object(f.a)(this,this.Irj,"onGetPolicyLabelsFailureCallback"),this.DUb("getpolicylabels",ud),mb,Oc,pd,id),this.dub++,l.ULS.sendTraceTag(34996492,
306,50,"Policy label request sent to server. Policy call times: {0}",this.dub))}wbk(mb,Oc,jd,ud=null,pd=null){if(this.pvc){this.ek&&(this.ZNa=this.ek.Sf("WebServiceCall","Call Set Policy Endpoint On Server"));var id={};id[Ya.a.Yrg]=mb;Oc&&(id[Ya.a.Dvg]=encodeURIComponent(Oc));this.x3c&&(id[Ya.a.Wih]=this.x3c);ud?(id[Ya.a.yvg]=this.bgi(ud),id[Ya.a.zvg]=this.khi(ud),1===ud.PR&&this.an.DefaultLabelType&&(id[Ya.a.ubk]=this.an.DefaultLabelType)):(id[Ya.a.yvg]="manual",id[Ya.a.zvg]="privileged");this.supportsOfficeClientCoauthoring&&
this.an&&(id[Ya.a.bFj]=this.an.PolicyLabelVersionToken);this.Fa.la("SendHostAttributionInfoForPolicyLabelEnabled")?(mb=new Hb(this.DUb("setpolicylabel",!0),1,null,id,!0,2,ud,void 0,this.z6()?pd:void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,jd),this.xk.send(mb).p2d(Object(f.a)(this,this.r7f,"onSetPolicyLabelSuccessCallback"),Object(f.a)(this,this.q7f,"onSetPolicyLabelFailureCallback"))):this.xk.ir(this.DUb("setpolicylabel",!0),1,null,id,!0,2,Object(f.a)(this,this.r7f,
"onSetPolicyLabelSuccessCallback"),Object(f.a)(this,this.q7f,"onSetPolicyLabelFailureCallback"),ud,this.z6()?pd:void 0,void 0,void 0,void 0,"32");this.yza++;l.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.yza)}else l.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}ybk(){const mb=new da.StandardDialog,Oc=this.Fa.Ta("BreadcrumbFolderUrl");Oc?(mb.Ye=11,mb.uf(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),
mb.uf(2,CommonUIStrings.l_DialogOk)):(mb.Ye=0,mb.uf(1,CommonUIStrings.l_DialogOk));mb.QKe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");mb.ZSj();mb.$X(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,jd=>{1===jd&&Oc&&Ta.a.Ph(Oc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}Bld(mb){return b(mb)}aIh(mb=
null){if(!mb)return lb.a.Mpa(8,0);switch(mb.PR){case 1:case 16:return lb.a.Mpa(1,1);case 4:case 2:case 8:return lb.a.Mpa(8,1);default:return lb.a.Mpa(8,0)}}a5d(mb){W.c()&&appChrome.api.setAsyncRequestStatus("sensitivity",mb)}Fdb(mb){return mb?mb.ParentId&&mb.ParentName?mb.ParentName+"\\"+mb.DisplayName:mb.DisplayName:""}getHighestSensitivityLabel(mb){if(!mb||0==mb.length)return null;let Oc=null;for(const jd of mb)if(""!==jd){mb=!1;for(const ud of this.an.SensitivityLabels)(null===ud||void 0===ud?
void 0:ud.Id)===jd&&(mb=!0,!Oc||ud.Order>Oc.Order)&&(Oc=ud);if(!mb)return null}Oc||(Oc=new db.a);return Oc}ahi(){return""===this.eC?new db.a:this.LIb(this.eC)}tryUpgradeLabel(mb,Oc){if(""===mb.Id)return 0;var jd=this.LIb(this.eC);mb=this.LIb(mb.Id);if(!mb)return 2147205112;if(!mb.Enabled)return 2147205117;if(mb.HasUserDefinedPermissions)return 2147205116;if(1==w.AFrameworkApplication.Oe.mode)return 2147205119;if(mb.RequiredDowngradeJustification||(null===jd||void 0===jd?void 0:jd.Order)>=mb.Order)return 2147205105;
jd=new y(4,this.Fdb(mb));this.OMc(mb.Id,"",jd,Oc);return 0}}Object(n.a)(Ca,"PolicyManager",null,[197]);var cb=a(147),hb=a(262);class ya{constructor(){this.b9=this.iza=this.$b=this.Nj=null;this.OYf=()=>{this.b9=this.$b.pj("CommonUI.BusinessBar");this.Nj||(this.Nj=this.$b.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.iza=this.$b.resolve("Common.App.Policy.PolicyActor");W.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?
this.Nj.hzb(Object(f.a)(this.iza,this.iza.Nhg,"registerActionsHandler")):this.iza.ik();this.Nj.hzb(this.kje);w.AFrameworkApplication.fa.la("WacApplyManualPolicyLabelIsEnabled")&&(this.Nj.acd(this.gGi),this.Nj.TLe(this.Eyb),this.Nj.hNe(this.ala),this.Nj.ULe(this.Had),this.Nj.iNe(this.o3d))};this.kje=()=>{this.iza.Jug();this.iza.uvg();this.iza.leg();const mb=this.Nj.Ywh();w.AFrameworkApplication.fa.la("HasDocumentEditRights")&&!mb?this.iza.cHg():l.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",
w.AFrameworkApplication.fa.la("HasDocumentEditRights"),mb);w.AFrameworkApplication.ra.px()};this.Pce=(mb,Oc)=>{this.xsf(Oc.title,Oc.wGc,38,Oc.HZf,Oc.buttonText);l.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};this.gGi=(mb,Oc)=>{Oc.Qzg&&(this.xsf(Oc.title,Oc.message,21,null,null,Oc.Oga,Oc.buttonText),l.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))};this.ala=
()=>{};this.Eyb=(mb,Oc)=>{this.b9&&(this.Nj.ala(Oc.mBb),mb=new h.a(Oc.title,Oc.message,null),mb.id=Oc.mBb,mb.closeable=!0,mb.image=3,mb.addButton(Oc.buttonText,Oc.Oga,Oc.buttonText,!0),this.b9.RA(mb,!1))};this.Had=(mb,Oc)=>{this.b9&&(mb=new h.a(Oc.title,Oc.message,null),mb.id=Oc.mBb,mb.closeable=!1,mb.image=3,mb.addButton(Oc.buttonText,Oc.Oga,Oc.buttonText,!1),this.b9.RA(mb,!1))};this.o3d=()=>{}}get name(){return"Common.App.Policy"}init(){w.AFrameworkApplication.fa.la("ShouldInitCommonPolicyPackage")&&
(w.AFrameworkApplication.fa.la("IsDataLossPreventionEnabledForUser")&&w.AFrameworkApplication.ra&&(this.Nj=this.$b.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Nj.eNe(this.Pce),l.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?cb.a.get_instance().Mk(5,()=>{this.Nj.eqc()}):cb.a.get_instance().Mk(6,()=>{this.Nj.eqc()})),w.AFrameworkApplication.fa.la("WacLabelingPoliciesIsEnabled")&&
w.AFrameworkApplication.fa.la("SupportsPolicies")?w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?cb.a.get_instance().Mk(5,this.OYf):cb.a.get_instance().Mk(6,this.OYf):(La.ZFk(),La.NJc(!1)))}dispose(){}dl(mb){mb.register(197,"Common.App.Policy.Contracts.IPolicyManager").If().Rf(()=>new Ca(w.AFrameworkApplication.fa,w.AFrameworkApplication.lg,w.AFrameworkApplication.ra.NG,w.AFrameworkApplication.fa.Ng("MaxGetPolicyRetries",1),mb.We("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
w.AFrameworkApplication.ra.Pa.Cj));mb.register(La,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").If().Rf(()=>new La(w.AFrameworkApplication.Oe,w.AFrameworkApplication.ra,w.AFrameworkApplication.fa,mb.eXb("Common.App.Policy.Contracts.IPolicyManager")));this.$b=mb}xsf(mb,Oc,jd,ud=null,pd=null,id=null,Ed=null){mb=new h.a(mb,Oc,null);mb.id=jd;mb.closeable=!0;ud&&mb.mah(pd,ud);id&&mb.addButton(Ed,id,Ed)}static main(){hb.a.instance.Ul(new ya)}}Object(n.a)(ya,"PackageManager",
null,[4,5]);var Pa=a(11),wb=a(536),Ib=a(299),pb=a(41),xc=a(137),ua=a(40),U=a(395),na=a(204),ob=a(68),bc=a(91),oc=a(33),Yb=a(241),Fc=a(1),ld=a(22),qd=a(252);class fe{constructor(){this.vGc=this.Osg=null;this.PR=0}}Object(n.a)(fe,"ApplyPolicyContextParameters",null,[]);var ge=a(2),Wd=a(788),Zd=a(598),ke=a(54),ne=a(50);class se{constructor(){this.y8a=this.annotationType=null;this.rfb=this.nE=!1}}Object(n.a)(se,"AnnotationActivationOptions",null,[]);var Cb=a(59);const ib=(mb,Oc,jd,ud,pd,id,Ed=null)=>
{Ed=mb.Oa(1,Ed);Ed.tenantId=Oc;return Cb.h(mb,"GetPolicyLabelId",Ed,jd,ud,pd,id,4)},ac=(mb,Oc,jd,ud,pd,id,Ed,Pd,lc,Kc,td=null)=>{td=mb.Oa(41,td);td.labelsInfoJson=Oc;td.appliedLabelId=jd;td.tenantId=ud;td.applyLabelFlag=pd;td.skipApplyOutcomes=id;return Cb.h(mb,"ApplyPolicyLabel",td,Ed,Pd,lc,Kc,0)},Lc=(mb,Oc,jd,ud,pd,id,Ed=null)=>{Ed=mb.Oa(1,Ed);Ed.tenantId=Oc;return Cb.h(mb,"GetPolicyApplicationMethod",Ed,jd,ud,pd,id,4)};var ad=a(823),te=a(795);class Ma extends ad.a{constructor(){super();this.source=
this.automatic=this.recommended=null;this.H_=Object.assign(new te.a,{T_:Ma.getTypeName(),B_:Ma.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(n.a)(Ma,"LabellingAnnotation",ad.a,[]);var V=a(808);class fa extends V.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new te.a,{T_:fa.getTypeName(),B_:fa.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static getBaseTypes(){return[]}}
Object(n.a)(fa,"SecurityShared",V.a,[]);class ub extends fa{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new te.a,{T_:ub.getTypeName(),B_:ub.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static getBaseTypes(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(n.a)(ub,"CLP",fa,[]);class rb extends ad.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new te.a,{T_:rb.getTypeName(),B_:rb.getBaseTypes()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
Object(n.a)(rb,"LabellingAnnotation",ad.a,[]);var hd=a(1086),Eb=a(969),kc=a(1088);class zc extends ad.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new te.a,{T_:zc.getTypeName(),B_:zc.getBaseTypes()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(n.a)(zc,"LinkedDataTypeAnnotation",ad.a,[]);var Nc=a(146),Fd=a(8),Xd=a(94);class ie extends ua.a{constructor(mb,Oc,jd,ud,pd){super();
this.OTf=3;this.MR=this.zk=null;this.Y8a=!1;this.rkb=[];this.MNf=new Wd.a(Zd.a.AP());this.x_d=0;this.C_d=null;this.yDb=(id,Ed)=>{id=Object(ge.a)(new hd.a,{parentPath:["session","doc","security"],items:[Object(ge.a)(new Eb.a,{id:"clp",body:Object(ge.a)(new ub,{existingLabelPriority:Ed.existingLabelPriority,partialDocSITs:Ed.kZe,fullDocSITs:Ed.jZe})})]});this.rkb.push(id);this.iLb()};this.eKg=(id,Ed)=>{id=Object(ge.a)(new kc.a,{parentPath:["session","doc","security"],items:[Object(ge.a)(new Eb.a,{id:"clp",
body:Object(ge.a)(new ub,{existingLabelPriority:Ed.existingLabelPriority})})]});this.rkb.push(id);this.iLb()};this.fKg=(id,Ed)=>{id=Object(ge.a)(new kc.a,{parentPath:["session","doc","security"],items:[Object(ge.a)(new Eb.a,{id:"clp",body:Object(ge.a)(new ub,{partialDocSITs:Ed.kZe,fullDocSITs:Ed.jZe})})]});this.rkb.push(id);this.iLb()};this.wB=()=>{l.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?Fc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.iLb():this.UBf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.MNh())};this.fZf=()=>{var id;l.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");null===(id=this.zk)||void 0===id?void 0:id.unregister("AutoPolicy");this.zk=null};this.j5i=(id,Ed)=>{var Pd,lc,Kc,td,zd;l.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Ed.operationType)l.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var me=id=null,Ae=null;if(this.rvc()){var ze=Ed.annotation;if(!ze){l.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Pd=ze.automatic)||void 0===Pd?0:Pd.id)id=ze.automatic.id;if(null===(lc=ze.recommended)||void 0===lc?0:lc.id)me=ze.recommended.id,ze.recommended.policyTip&&(Ae=ze.recommended.policyTip)}else{Pd=Ed.annotation;if(!Pd){l.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(Kc=null===(ze=Pd.automatic)||void 0===ze?void 0:ze.sensitivityLabel)||void 0===Kc?0:Kc.id)id=Pd.automatic.sensitivityLabel.id;if(null===(zd=null===(td=Pd.recommended)||void 0===td?void 0:td.sensitivityLabel)||void 0===zd?0:zd.id)me=Pd.recommended.sensitivityLabel.id,Pd.recommended.sensitivityLabel.policyTip&&(Ae=Pd.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(id,me,Ae,1)}};this.r7i=(id,Ed)=>{l.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===Ed.operationType?l.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(id=Ed.annotation)?(id=id.classificationId,this.applyPolicyLabel(id,id,null,2)):l.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.Xig=(id,Ed)=>{Ed?Ed.MNb&&this.businessBar.EJ(41)?(this.businessBar.removeEntry(41),l.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Ed.MNb&&this.businessBar.EJ(40)&&(this.businessBar.removeEntry(40),l.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):l.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.Yyg=(id,Ed)=>{Ed?Ed.MNb?(this.businessBar.Vlk(Ed.title,Ed.message,Ed.buttonText,Pd=>{Ed.Oga(Pd);this.businessBar.EJ(41)&&this.businessBar.removeEntry(41)}),l.ULS.sendTraceTag(537154531,306,
50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.wjk(Ed.title,Ed.message,Ed.buttonText,Pd=>{Ed.Oga(Pd);this.businessBar.EJ(40)&&this.businessBar.removeEntry(40)}),l.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):l.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.eZd=
mb;this.policyManager=Oc;this.$=jd;this.fa=ud;this.businessBar=pd;this.zLi();this.aQj();this.disposed=!1}get tf(){return!this.disposed&&this.$.ea.tf}dispose(){var mb;this.disposed||(this.disposed=!0,this.JPh(),null===(mb=this.zk)||void 0===mb?void 0:mb.unregister("AutoPolicy"),this.eZd=this.policyManager=this.zk=null,super.dispose())}E8a(mb,Oc,jd,ud,pd=!1){l.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${ud} with AutoLabelPresent: ${!!mb}, RecommendedLabelPresent: ${!!Oc}, isStandard: ${pd}.`);
this.tf?this.eZd&&(this.Fuh(Oc,ud)?(this.C_d=Oc,this.x_d=ud,this.MNf.da(ud,Oc)):Oc=this.C_d,mb=this.eZd.E8a(mb,Oc,jd,pd),l.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${mb}.`)):l.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.tf}.`)}Fuh(mb,Oc){if(!this.policyManager.Loa())return l.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),
!1;const jd=this.policyManager.an;let ud;({value:ud}=this.MNf.Ag(this.x_d));let pd=null,id=null,Ed=null;for(const Pd of jd.SensitivityLabels)Pd.Id===mb&&(pd=Pd),Pd.Id===ud&&(id=Pd),Pd.Id===this.C_d&&(Ed=Pd);return id&&id.Id===mb?(l.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.EJ(41)&&this.x_d!==Oc&&Ed&&(!pd||Ed.Order>=pd.Order)?(l.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0}rvc(){return Fc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}vEf(){return Fc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}aQj(){this.policyManager.TLe(this.Yyg);this.policyManager.hNe(this.Xig);this.$.ea.aM(this.wB);this.rvc()&&this.vEf()&&
(this.policyManager.pdh(this.yDb),this.policyManager.ogh(this.eKg),this.policyManager.pgh(this.fKg))}JPh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);this.policyManager.UTj(this.Yyg);this.policyManager.AWj(this.Xig);this.$.ea.UK(this.wB);this.rvc()&&this.vEf()&&(this.policyManager.EUj(this.yDb),this.policyManager.iXj(this.eKg),this.policyManager.jXj(this.fKg))}zLi(){this.MR=new Wd.a(Zd.a.AP());const mb=this.rvc()?Ma.getTypeName():rb.getTypeName();this.MR.add(1,Object(ge.a)(new se,
{annotationType:mb,y8a:this.j5i,nE:!1,rfb:!1}));this.MR.add(2,Object(ge.a)(new se,{annotationType:zc.getTypeName(),y8a:this.r7i,nE:!1,rfb:!1}))}tDg(){for(const mb of this.rkb)this.zk.submitOperation(mb);this.rkb=[]}Qua(mb){if(!this.MR.$d(mb))return l.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${mb}.`),!1;if(this.MR.ka(mb).nE)return l.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${mb}.`),
!0;this.MR.ka(mb).nE=!0;l.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${mb}.`);if(!this.$.isEditMode)return l.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;Fc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.iLb():this.UBf();return!0}UBf(){var mb=!1;for(const Oc of this.MR)if(mb=Oc.value.nE||
mb)break;mb?this.zk?(l.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.Yac()):this.Y8a?l.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.Y8a=!0,mb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,l.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${mb} milliseconds.`),
ke.a.instance.create(()=>{this.CLi()},mb,ne.a.rSe,!0,!0)):l.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}iLb(){var mb=0<this.rkb.length;if(!mb)for(const Oc of this.MR)if(mb=Oc.value.nE||mb)break;mb?this.zk?(l.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.Yac(),this.tDg()):this.Y8a?l.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.Y8a=!0,mb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,l.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${mb} milliseconds.`),ke.a.instance.create(()=>{this.DLi()},mb,ne.a.rSe,!0,!0)):l.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}DLi(){pb.TaskExtensions.Ca(Object(Xd.d)(Nc.a.resolve(Fd.l,{Aa:1})),mb=>{this.zk=mb.result;this.Y8a=!1;
this.zk?(l.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.zk.register(this.zk.fW().WX("AutoPolicy").VX(this.fZf).build()),this.$.isEditMode?(this.Yac(),this.tDg()):l.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):l.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.qa,
3)}CLi(){pb.TaskExtensions.Ca(Object(Xd.d)(Nc.a.resolve(Fd.l,{Aa:1})),mb=>{this.zk=mb.result;this.Y8a=!1;this.zk?(l.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.zk.register(this.zk.fW().WX("AutoPolicy").VX(this.fZf).build()),this.$.isEditMode?this.Yac():l.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):l.ULS.sendTraceTag(537154593,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.qa,3)}Yac(){for(const mb of this.MR)mb.value.nE&&!mb.value.rfb&&this.activateAnnotation(mb.key)}activateAnnotation(mb){this.zk.Qua("AutoPolicy",{annotationType:this.MR.ka(mb).annotationType,jy:!0,gX:this.MR.ka(mb).y8a});this.MR.ka(mb).rfb=!0;l.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${mb}.`)}MNh(){for(const mb of this.MR)mb.value.rfb&&this.Jjc(mb.key)}Jjc(mb){var Oc;null===(Oc=this.zk)||void 0===Oc?void 0:Oc.nBk(this.MR.ka(mb).annotationType);
this.MR.ka(mb).rfb=!1;l.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${mb}.`)}applyPolicyLabel(mb,Oc,jd,ud){if(this.fa.la("SupportsOfficeClientCoauthoring"))l.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.E8a(mb,Oc,jd,ud);else{l.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const pd=id=>{this.E8a(mb,
Oc,jd,ud,0===id||1===id||4===id)};this.Lzd(pd,()=>{pd(2)},this.OTf)}}med(mb,Oc){let jd=null,ud=null;if(!({sensitivityLabel:jd,uPa:ud}=this.$Hg(mb)).returnValue)return l.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(ud&&ud.Order>=jd.Order)return l.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(jd.Id,jd.Id,null,Oc);return!0}ned(mb,Oc){Oc=!1;
let jd=null,ud=null;if(!({sensitivityLabel:jd,uPa:ud}=this.$Hg(mb)).returnValue)return l.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,Ofb:Oc};if(ud&&ud.ParentId&&jd.ParentId&&ud.ParentId===jd.ParentId)return l.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,Ofb:Oc};if(ud&&ud.Order>=jd.Order)return l.ULS.sendTraceTag(537154573,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,Ofb:Oc};if(this.fa.la("SupportsOfficeClientCoauthoring"))l.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),mb=this.policyManager.an,mb=!mb.AppliedPolicyId||!mb.PolicyLabelAssignmentMethod||za.e(mb.PolicyLabelAssignmentMethod)===za.e("standard"),this.EQe(jd.Id,mb);else{l.ULS.sendTraceTag(537154571,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const pd=id=>{this.EQe(jd.Id,0===id||1===id||4===id)};this.Lzd(pd,()=>{pd(2)},this.OTf)}return{returnValue:!0,Ofb:Oc}}Lzd(mb,Oc,jd,ud=0){if(this.tf){var pd=this.$.oa.ua.qf();Lc(this.$.oa.ua,this.$.xa.DocumentHostInfo.TenantId,id=>{this.Uti(id,mb)},()=>{this.Tti(mb,Oc,jd,ud)},null,null,pd)}else l.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.tf}.`)}Uti(mb,
Oc){l.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.tf?!mb||Yb.a(mb)?l.ULS.sendTraceTag(537154567,306,15,mb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Oc(mb.Result):l.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.tf}.`)}Tti(mb,
Oc,jd,ud){l.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.tf?ud>=jd?(l.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Oc()):this.Lzd(mb,Oc,jd,ud+1):l.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.tf}.`)}EQe(mb,Oc){Oc?this.E8a(mb,null,null,
3,!0):this.E8a(null,mb,null,3,!1)}$Hg(mb){let Oc,jd;jd=Oc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Oc,uPa:jd};if(!this.policyManager.Loa())return l.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Oc,uPa:jd};const ud=this.policyManager.an;if(!ud)return l.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Oc,
uPa:jd};if(Va.a.$j(ud.SensitivityLabels))return l.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Oc,uPa:jd};const pd=ud.AppliedPolicyId;for(const id of mb)for(const Ed of ud.SensitivityLabels)Ed.Id===id&&(!Oc||Oc.Order<Ed.Order)&&(Oc=Ed),Ed.Id===pd&&(jd=Ed);return Oc?{returnValue:!0,sensitivityLabel:Oc,uPa:jd}:(l.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),
{returnValue:!1,sensitivityLabel:Oc,uPa:jd})}}Object(n.a)(ie,"AutoPolicyManager",ua.a,[2]);var Ee=a(176),He=a(14),gd=a(13);class Bd extends Ee.ErrorDialog{constructor(mb){super(mb,Bd.eia(mb))}vy(){super.vy();if(this.error.Appearance&1&&this.$.Wg&2){const mb=this.getButton(0);He.DOMElementExtensions.b$d(mb.get_element(),gd.a.instance.ia(1315));this.qZ(()=>{0===this.returnValue&&this.$.Wg&2&&(l.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),
Fd.Rc.$e()?void Nc.a.resolve(Fd.Rc,{Aa:0}).then(Oc=>{Oc.lDb()}):pb.TaskExtensions.Ca(ob.GetServiceTaskFactory.vf(this.$.ja,55,56,0),Oc=>{Oc.result.lDb()},this.$.qa,3))})}}static eia(mb){return mb.Wg&2?oc.a.Fg(3,1,0,1975,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):oc.a.Fg(1,1,0,1976,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(n.a)(Bd,"BlockSenitivityLabelActionDialog",Ee.ErrorDialog,[]);var ue=a(27),ye=a(93);class Ue extends ua.a{constructor(mb,Oc,jd,ud,pd){super();this.statusBarManager=
null;this.pfd=!1;this.Kga=null;this.hTc=!1;this.uGa=this.n9d=null;this.uK=this.fZd=!1;this.WMa=this.wBe=this.ena=this.GCe=this.Xt=null;this.I$e=()=>{l.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const id=this.$Pj();l.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${id}.`)};this.Pce=(id,Ed)=>{Ed?(this.Xt=Ed.title,this.GCe=Ed.wGc,this.ena=Ed.buttonText,
this.wBe=Ed.HZf,this.Pga.Uj(27,null),l.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):l.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.tAg=(id,Ed)=>{const Pd=Object(xc.a)(ab,Ed);Pd?Pd.Qzg?(l.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Pd.errorType}`),this.Pga.fmk(Pd.title,Pd.message,Pd.buttonText,lc=>{Pd.Oga&&(this.Pga.EJ(54)&&
this.Pga.removeEntry(54),Pd.Oga(lc))})):l.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(l.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.Pga.Uj(48,null))};this.kje=(id,Ed)=>{this.ida&&(l.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.ida.Jug(),this.ida.uvg(),this.ida.leg(),this.$.Wg&64&&(Ed.nX&&this.uGa?this.Tjh():
this.ida.cHg()));this.fa.la("SupportsOfficeClientCoauthoring")&&(id=this.hx.an,this.WMa=id.AppliedPolicyId,"null"===this.labelId&&(this.WMa=""),this.hTc&&(id=id.PolicyLabelAssignmentMethod&&za.e(id.PolicyLabelAssignmentMethod)===za.e("standard")?4:2,this.applyPolicyLabel(this.labelId,id,!0,this.n9d)));this.czh();this.Jgf();this.gA()};this.l2f=()=>{this.fZd=!0;this.Jgf()};this.p7f=(id,Ed)=>{l.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${w.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Ed.PR}`);
this.applyPolicyLabel(Ed.vGc,Ed.PR,!1,null)};this.klj=(id,Ed)=>{this.WMa=Ed.vGc;if(oc.a.wt(id.Errors)){var Pd=oc.a.Xaa(id.Errors,[2045508683]);0<Pd.length&&(id.Errors=oc.a.vG(id.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Kr(id.Errors));Pd=oc.a.Xaa(id.Errors,[2046680228]);0<Pd.length&&(4===Ed.PR||1===Ed.PR)&&(id.Errors=oc.a.vG(id.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Kr(id.Errors));Pd=id=null;
for(var lc of this.hx.an.SensitivityLabels)ld.a.equals(this.labelId,lc.Id,!1)&&(id=lc),ld.a.equals(Ed.Osg,lc.Id,!1)&&(Pd=lc);lc={};lc.ApplyLabelFlag=Ed.PR;id?(lc.currentLabel="Set",lc.currentLabelEnabled=id.Enabled,lc.currentLabelName=id.Name?"Set":"NotSet",lc.currentLabelParentId=id.ParentId?"Set":"NotSet"):lc.currentLabel="NotSet";Pd?(lc.serverLabel="Set",lc.serverLabelEnabled=Pd.Enabled,lc.serverLabelName=Pd.Name?"Set":"NotSet",lc.serverLabelParentId=Pd.ParentId?"Set":"NotSet"):lc.serverLabel=
"NotSet";l.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(lc)}`)}};this.Znh=(id,Ed)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const Pd=this.hx.an;if(!Pd)return l.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let lc=null;for(const Kc of Pd.SensitivityLabels)ld.a.equals(Kc.Id,id,!1)&&(lc=Kc);return lc&&this.YHi(lc)?(l.ULS.sendTraceTag(50341186,
306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.zjk(Ed),!0):!1};this.YRi=()=>{let id=!1;!this.$.xa.IsNewWorkbook||this.labelId&&this.labelId.length||(id=!0);l.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${id}`);return id};this.DTf=(id,Ed)=>{1===Ed.rPe?this.$.isEditMode?(l.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ha.Me(new bc.a(-723527778,
0,this.$.zf,10,null))):l.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.uGa=Ed.uGa,this.$.ea.aM(this.yQe),this.$.Iqb(),l.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ha.Me(new bc.a(-8805455,0,this.$.zf,10,null)))};this.TKe=(id,Ed)=>{Ed?(id=!!(this.$.Wg&64),l.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${id}`),id&&(this.$.Iqb(),this.Pga.flk(Ed.title,
Ed.message,Ed.buttonText,Pd=>{Ed.Oga(Pd)}))):l.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.yjg=()=>{this.Pga.EJ(42)&&this.Pga.removeEntry(42)};this.IIg=(id,Ed)=>{Ed.mhk&&(l.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),Fd.Rc.$e()?void Nc.a.resolve(Fd.Rc,{Aa:0}).then(Pd=>{Pd.lDb()}):pb.TaskExtensions.Ca(ob.GetServiceTaskFactory.vf(this.$.ja,
55,56,0),Pd=>{Pd.result.lDb()},this.$.qa,3))};this.yQe=()=>{this.uGa&&this.$.isEditMode?(this.$.ea.UK(this.yQe),this.iIb()):l.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.uGa} , edit mode : ${this.$.isEditMode}.`)};this.sia=()=>{const id=this.$.ea.Vq;id&&!ld.a.equals(id.AppliedPolicyLabelId,this.labelId,!1)&&(l.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),
l.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.la("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&(this.hTc=!0,this.n9d=id.AppliedPolicyLabelId),this.WMa=id.AppliedPolicyLabelId,this.iIb())};this.eId=()=>{let id=!0;if(!this.$.ea.xZ)for(const Ed of this.$.ea.Zo)if(!Ed.SupportsClientIsMipTrusted){id=!1;break}l.ULS.sendTraceTag(537154462,
306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${id}`);return id};this.A3f=()=>{l.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.hTc=!0;this.iIb()};this.$=ud;this.hx=mb;this.Pga=jd;this.fa=pd;this.hx.eNe(this.Pce);this.ida=Oc}initialize(){this.fa.la("SupportsPolicies")?(this.WMa=this.fa.Ta("AppliedPolicyId"),this.ida.ik(),this.$.ja.Ne(29,mb=>{this.statusBarManager=mb;mb.YL(this)}),this.gA(),ld.a.$j(this.fa.Ta("HostUserId"))||
this.cFj(),this.ida.cQj(this.Znh),this.ida.WQj(this.YRi),this.hx.YPj(this.eId),this.uK=!0):W.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!ld.a.$j(this.fa.Ta("HostUserId"))&&Fc.EwaSettings.Ia(158)&&this.$.ea.qk.get(45)&&(l.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.ami())}$t(mb){this.addHandler("LabelInfoChangedKey",mb)}Eu(mb){this.removeHandler("LabelInfoChangedKey",mb)}wq(){return!0}Ov(mb,Oc){if("QueryPolicyLabel"!==
mb)return!1;if(this.$va())return Oc.Visible=!1,!0;!ld.a.$j(Oc.LabelText)&&ue.a.An(this.$)&&window.setTimeout(()=>{appChrome.api.dispatch(appChrome.actions.setControlCustomTooltip(ye.a.ugc,Oc.Alt))},0);Oc.Visible=!0;return 32===w.AFrameworkApplication.Oe.rh(Xa.a.Ilb,2,Oc)}dispose(){this.statusBarManager&&(this.statusBarManager.FI(this),this.statusBarManager=null);this.ida.WRc();this.pfd=!1;this.hx.XWj(this.tAg);this.hx.YWj(this.p7f);this.$.ea.pA(this.sia);if(this.fa.la("SupportsOfficeClientCoauthoring")){const mb=
this.$.ja.Qa(292);mb&&mb.GVj(this.A3f)}this.hx.WTj(this.TKe);this.hx.BWj(this.yjg);this.hx.OVj(this.DTf);this.hx.hXj(this.IIg);this.hx.eVj(this.I$e);this.Kga&&(this.Kga.dispose(),this.Kga=null);super.dispose()}get title(){return this.Xt}get wGc(){return this.GCe}get linkText(){return this.ena}get Utj(){return this.wBe}get labelId(){return this.WMa}med(mb,Oc){if(!this.fa.la("SupportsPolicies"))return l.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.fZd)return l.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Va.a.$j(mb))return!1;this.Kga||this.kFd();return this.Kga.med(mb,Oc)}gA(){this.raiseEvent("LabelInfoChangedKey")}ami(){cb.a.get_instance().Mk(10,()=>{this.hx.eqc()})}cFj(){cb.a.get_instance().Mk(10,()=>{this.hx.hzb(this.kje);this.hx.$dh(this.l2f);this.hx.Zdh(this.l2f);this.hx.acd(this.tAg);this.hx.qNe(this.p7f);this.$.ea.Jy(this.sia);this.hx.ULe(this.TKe);this.hx.iNe(this.yjg);
this.hx.Keh(this.DTf);this.hx.mgh(this.IIg);if(this.fa.la("SupportsOfficeClientCoauthoring")){const mb=this.$.ja.Qa(292);mb&&mb.Beh(this.A3f)}l.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler");this.hx.Xdh(this.I$e);this.E8h()});this.$.L$d("sensitivity",!0)}E8h(){this.fa.la("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.iIb():this.bhi(this.$.xa.DocumentHostInfo.TenantId)}kFd(){this.Kga=
new ie(this.ida,this.hx,this.$,this.fa,this.Pga)}$Pj(){if(!this.fa.la("SupportsPolicies"))return l.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.Kga||this.kFd();return this.Kga.Qua(1)}ned(mb,Oc){if(!this.fa.la("SupportsPolicies"))return l.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,Ofb:!1};if(!this.fZd)return l.ULS.sendTraceTag(537154516,
306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,Ofb:!0};this.Kga||this.kFd();return this.Kga.ned(mb,Oc)}bhi(mb){l.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${mb.length}`);const Oc=this.$.oa.ua.qf();ib(this.$.oa.ua,mb,jd=>{this.Hrk(jd)},null,null,null,Oc)}Hrk(mb){l.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");
mb&&!Yb.a(mb)&&(this.WMa=mb.Result);this.iIb();this.labelId?l.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):l.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}iIb(){this.hx.pxd(this.labelId,void 0,void 0,!1)}czh(){ue.a.n6()&&Fc.EwaSettings.isChangeGateEnabled("OfficeVSO:8386937_NoCopilotTaskPaneWhenNoExtractPermissions")&&(!w.AFrameworkApplication.protectedFile&&!w.AFrameworkApplication.JZa||
w.AFrameworkApplication.enableExtractForProtectedFile||this.$.Lf(762629271,-1,0,null))}Jgf(){if(!this.pfd){this.$.Tj();this.pfd=!0;this.Pga.Mxf();const mb={};mb.hasLabel=!!this.labelId&&0<this.labelId.length;mb.isProtectedFile=this.fa.la("ProtectedFile");mb.SupportsPolicies=this.fa.la("SupportsPolicies");mb.AreLabelsAvailableForDisplay=this.hx.Loa();mb.SupportsOfficeClientCoauthoring=this.fa.la("SupportsOfficeClientCoauthoring");mb.IsAnonymousUser=this.fa.la("IsAnonymousUser");l.ULS.sendTraceTag(51238051,
306,50,`CLPUsage : ${JSON.stringify(mb)}`)}}Tjh(){this.ida.Ujh(this.uGa);this.uGa=null}YHi(mb){for(const Oc of mb.LabelActions)if(ld.a.equals(Oc.Name,"ApplyWatermark",!1))return!0;return!1}zjk(mb){mb?(new Bd(this.$)).Hn():l.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(mb,Oc,jd,ud){const pd=mc.c(this.hx.an);if(void 0===mb||null===mb)mb="";const id=new fe;id.vGc=mb;
id.Osg=ud;id.PR=Oc;const Ed=this.$.oa.ua;U.a(this.$.userOperationManager,(Pd,lc,Kc)=>ac(Ed,pd,mb,this.$.xa.DocumentHostInfo.TenantId,Oc,jd,qd.b.call(null,this.klj,Pd),null,Kc,id),Pd=>new na.a(222,0,Pd),null);this.hTc=!1;this.n9d=null}$va(){const mb=Fc.EwaSettings.qFa()?Nc.a.mg(Fd.Wc):this.$.ja.Qa(478);return this.uK&&mb?mb.uK():!1}}Object(n.a)(Ue,"PolicyManagerWrapper",ua.a,[256,169,257]);class Sb extends Ib.a{constructor(mb){super();this.$=mb;this.Dg()}create(){const mb=Object(Xd.d)(Nc.a.resolve(Fd.s,
{Aa:this.$a})),Oc=w.AFrameworkApplication.lg,jd=w.AFrameworkApplication.fa;pb.TaskExtensions.Ca(mb,()=>{try{let ud,pd;Fc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1)?(qa.a.instance.register(197,"Common.App.Policy.Contracts.IPolicyManager").If().Rf(()=>new Ca(jd,Oc,w.AFrameworkApplication.ra.NG,this.$.xa.MaxGetPolicyRetries,qa.a.instance.We("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),ud=qa.a.instance.eXb("Common.App.Policy.Contracts.IPolicyManager"),
qa.a.instance.register(La,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").If().Rf(()=>new La(w.AFrameworkApplication.Oe,w.AFrameworkApplication.ra,w.AFrameworkApplication.fa,ud)),pd=qa.a.instance.eXb("Common.App.Policy.Contracts.IPolicyActor")):(ud=new wb.a(()=>new Ca(jd,Oc,w.AFrameworkApplication.ra.NG,this.$.xa.MaxGetPolicyRetries,qa.a.instance.We("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),pd=new wb.a(()=>new La(w.AFrameworkApplication.Oe,
w.AFrameworkApplication.ra,w.AFrameworkApplication.fa,ud)));let id=this.$.ja.Qa(274);id||(id=new Ue(ud.value,pd.value,mb.result,this.$,w.AFrameworkApplication.fa),this.$.ja.$c(274,id),id.initialize());this.Df(id)}catch(ud){throw l.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${ud.toString()}]`),ud;}},this.qa,3)}static ta(mb){mb.ja.$c(275,new Sb(mb))}}Object(n.a)(Sb,"PolicyManagerFactory",Ib.a,[]);var cd=a(203),Xc=a(201);let fd=class{constructor(mb){this.$=
mb}Uf(){return!1}executeCommand(mb,Oc,jd){switch(Oc.command){case Xa.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(jd[L.Wcd]=this.$.workbookContext.ExclusiveLockId),mb=w.AFrameworkApplication.Oe.rh(Xa.a.setSensitivity,2,jd),Za.Task.Ra(32===mb);case Xa.a.z7:return mb=w.AFrameworkApplication.Oe.rh(Xa.a.z7,2,jd),Za.Task.Ra(32===mb);case Xa.a.D1:return mb=w.AFrameworkApplication.Oe.rh(Xa.a.D1,2,jd),Za.Task.Ra(32===mb);default:return Xc.a(Oc.command)}}Kf(mb,Oc){switch(Oc.command){case Xa.a.setSensitivity:case Xa.a.z7:case Xa.a.D1:return!0;
default:return!1}}Yf(mb,Oc,jd){switch(Oc){case "PopulateSensitivityFlyout":return 32===w.AFrameworkApplication.Oe.rh(Xa.a.MHa,2,jd);default:return!1}}};fd=Object(cd.__decorate)([Object(Nc.d)(Fd.Gd),Object(cd.__param)(0,Object(Fd.nb)())],fd);Object(n.a)(fd,"SensitivityCommandHandler",null,[165]);Type.registerNamespace("Common.App.Policy");ya.main();(()=>{Pa.a.Na(mb=>{Sb.ta(mb)})})();String(d);window.___1699049107566_closurehack=d}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.policy.js.map/810202012076ebe6b4297fc5120e019b/EwaTS.policy.js.map